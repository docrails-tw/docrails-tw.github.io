<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-TW" lang="zh-TW">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Active Record PostgreSQL — Ruby on Rails 指南</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多內容 <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多內容
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">綜覽</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/download">下載</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/deploy">部署</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">原始碼</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/screencasts">影片</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/documentation">文件</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/community">社群</a></li>
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">Blog</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南目錄</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>起步走</dt>
                <dd><a href="getting_started.html">Rails 入門指南</a></dd>
                <dt>Models</dt>
                <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                <dd><a href="migrations.html">Active Record 遷移</a></dd>
                <dd><a href="active_record_validations.html">Active Record 驗證</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record 回呼</a></dd>
                <dd><a href="association_basics.html">Active Record 關聯</a></dd>
                <dd><a href="active_record_querying.html">Active Record 查詢</a></dd>
                <dt>Views</dt>
                <dd><a href="layouts_and_rendering.html">Rails 算繪與版型</a></dd>
                <dd><a href="form_helpers.html">Action View 表單輔助方法</a></dd>
                <dt>Controllers</dt>
                <dd><a href="action_controller_overview.html">Action Controller 綜覽</a></dd>
                <dd><a href="routing.html">Rails 路由：深入淺出</a></dd>
              </dl>
              <dl class="R">
                <dt>深入了解</dt>
                <dd><a href="active_support_core_extensions.html">Active Support 核心擴展</a></dd>
                <dd><a href="i18n.html">Rails 國際化 API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer 基礎</a></dd>
                <dd><a href="security.html">Rails 安全指南</a></dd>
                <dd><a href="debugging_rails_applications.html">Rails 應用程式除錯</a></dd>
                <dd><a href="configuring.html">Rails 設定應用程式</a></dd>
                <dd><a href="command_line.html">Rake 任務與 Rails 命令行工具</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">在 Rails 使用 JavaScript</a></dd>
                <dt>擴充 Rails</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                <dd><a href="generators.html">客製與新建 Rails 產生器</a></dd>
                <dd><a href="rails_application_templates.html">Rails 應用程式模版</a></dd>
                <dt>貢獻至 Ruby on Rails</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">貢獻至 Ruby on Rails</a></dd>
                <dd><a href="api_documentation_guidelines.html">API 文件準則</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</a></dd>
                <dt>維護方針</dt>
                <dd><a href="maintenance_policy.html">維護方針</a></dd>
                <dt>發佈記</dt>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 發佈記</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 發佈記</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 發佈記</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 發佈記</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 發佈記</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 發佈記</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 發佈記</a></dd>
              </dl>
          </div>
        </li>
        <!-- <li><a class="nav-item" href="//github.com/docrails-tw/wiki">參與翻譯</a></li> -->
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li><a class="nav-item" href="credits.html">致謝</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南目錄</option>
              <optgroup label="起步走">
                  <option value="getting_started.html">Rails 入門指南</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="migrations.html">Active Record 遷移</option>
                  <option value="active_record_validations.html">Active Record 驗證</option>
                  <option value="active_record_callbacks.html">Active Record 回呼</option>
                  <option value="association_basics.html">Active Record 關聯</option>
                  <option value="active_record_querying.html">Active Record 查詢</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 算繪與版型</option>
                  <option value="form_helpers.html">Action View 表單輔助方法</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller 綜覽</option>
                  <option value="routing.html">Rails 路由：深入淺出</option>
              </optgroup>
              <optgroup label="深入了解">
                  <option value="active_support_core_extensions.html">Active Support 核心擴展</option>
                  <option value="i18n.html">Rails 國際化 API</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎</option>
                  <option value="security.html">Rails 安全指南</option>
                  <option value="debugging_rails_applications.html">Rails 應用程式除錯</option>
                  <option value="configuring.html">Rails 設定應用程式</option>
                  <option value="command_line.html">Rake 任務與 Rails 命令行工具</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">在 Rails 使用 JavaScript</option>
              </optgroup>
              <optgroup label="擴充 Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">客製與新建 Rails 產生器</option>
                  <option value="rails_application_templates.html">Rails 應用程式模版</option>
              </optgroup>
              <optgroup label="貢獻至 Ruby on Rails">
                  <option value="contributing_to_ruby_on_rails.html">貢獻至 Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API 文件準則</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</option>
              </optgroup>
              <optgroup label="維護方針">
                  <option value="maintenance_policy.html">維護方針</option>
              </optgroup>
              <optgroup label="發佈記">
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 發佈記</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 發佈記</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 發佈記</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 發佈記</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 發佈記</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 發佈記</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 發佈記</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Record PostgreSQL</h2><p>本篇介紹 Active Record PostgreSQL 的具體用法。</p><p>讀完本篇，您將了解：</p>
<ul>
<li>如何使用 PostgreSQL 的資料類型。</li>
<li>如何使用 UUID 主鍵。</li>
<li>如何在 PostgreSQL 實作全文搜索。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#%E8%B3%87%E6%96%99%E9%A1%9E%E5%9E%8B">資料類型</a>

<ul>
<li><a href="#bytea-%E9%A1%9E%E5%9E%8B">Bytea 類型</a></li>
<li><a href="#%E9%99%A3%E5%88%97%E9%A1%9E%E5%9E%8B">陣列類型</a></li>
<li><a href="#hstore-%E9%A1%9E%E5%9E%8B">Hstore 類型</a></li>
<li><a href="#json-%E9%A1%9E%E5%9E%8B">JSON 類型</a></li>
<li><a href="#range-%E9%A1%9E%E5%9E%8B">Range 類型</a></li>
<li><a href="#%E8%A4%87%E5%90%88%E9%A1%9E%E5%9E%8B">複合類型</a></li>
<li><a href="#%E6%9E%9A%E8%88%89%E9%A1%9E%E5%9E%8B">枚舉類型</a></li>
<li><a href="#uuid-%E9%A1%9E%E5%9E%8B">UUID 類型</a></li>
<li><a href="#%E4%BD%8D%E5%85%83%E5%AD%97%E4%B8%B2%E9%A1%9E%E5%9E%8B">位元字串類型</a></li>
<li><a href="#%E7%B6%B2%E8%B7%AF%E4%BD%8D%E5%9D%80%E9%A1%9E%E5%9E%8B">網路位址類型</a></li>
<li><a href="#%E5%B9%BE%E4%BD%95%E9%A1%9E%E5%9E%8B">幾何類型</a></li>
</ul>
</li>
<li><a href="#uuid-%E4%B8%BB%E9%8D%B5">UUID 主鍵</a></li>
<li><a href="#%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2">全文搜索</a></li>
<li><a href="#views">Views</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <p>PostgreSQL 的最低版本要求為 8.2。舊版不支援。</p><p>開始使用 PostgreSQL 之前，請先看看<a href="configuring.html#configuring-a-postgresql-database">如何為 Active Record 設定 PostgreSQL 資料庫</a>。</p><h3 id="資料類型">1 資料類型</h3><p>PostgreSQL 提供許多具體的資料類型。以下是 PostgreSQL 連接器所支援的類型列表。</p><h4 id="bytea-類型">1.1 Bytea 類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-binary.html">類型定義</a></li>
<li><a href="http://www.postgresql.org/docs/9.3/static/functions-binarystring.html">函數與運算元</a></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20140207133952_create_documents.rb
create_table :documents do |t|
  t.binary 'payload'
end

# app/models/document.rb
class Document &lt; ActiveRecord::Base
end

# 用途
data = File.read(Rails.root + "tmp/output.pdf")
Document.create payload: data

</pre>
</div>
<h4 id="陣列類型">1.2 陣列類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/arrays.html">類型定義</a></li>
<li><a href="http://www.postgresql.org/docs/9.3/static/functions-array.html">函數與運算元</a></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20140207133952_create_books.rb
create_table :book do |t|
  t.string 'title'
  t.string 'tags', array: true
  t.integer 'ratings', array: true
end

# app/models/book.rb
class Book &lt; ActiveRecord::Base
end

# 用途
Book.create title: "Brave New World",
            tags: ["fantasy", "fiction"],
            ratings: [4, 5]

## Books for a single tag
Book.where("'fantasy' = ANY (tags)")

## Books for multiple tags
Book.where("tags @&gt; ARRAY[?]::varchar[]", ["fantasy", "fiction"])

## Books with 3 or more ratings
Book.where("array_length(ratings, 1) &gt;= 3")

</pre>
</div>
<h4 id="hstore-類型">1.3 Hstore 類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/hstore.html">類型定義</a></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131009135255_create_profiles.rb
ActiveRecord::Schema.define do
  create_table :profiles do |t|
    t.hstore 'settings'
  end
end

# app/models/profile.rb
class Profile &lt; ActiveRecord::Base
end

# 用途
Profile.create(settings: { "color" =&gt; "blue", "resolution" =&gt; "800x600" })

profile = Profile.first
profile.settings # =&gt; {"color"=&gt;"blue", "resolution"=&gt;"800x600"}

profile.settings = {"color" =&gt; "yellow", "resolution" =&gt; "1280x1024"}
profile.save!

## you need to call _will_change! if you are editing the store in place
profile.settings["color"] = "green"
profile.settings_will_change!
profile.save!

</pre>
</div>
<h4 id="json-類型">1.4 JSON 類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-json.html">類型定義</a></li>
<li><a href="http://www.postgresql.org/docs/9.3/static/functions-json.html">函數與運算元</a></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_events.rb
create_table :events do |t|
  t.json 'payload'
end

# app/models/event.rb
class Event &lt; ActiveRecord::Base
end

# 用途
Event.create(payload: { kind: "user_renamed", change: ["jack", "john"]})

event = Event.first
event.payload # =&gt; {"kind"=&gt;"user_renamed", "change"=&gt;["jack", "john"]}

## 基於 JSON 文件的查詢
Event.where("payload-&gt;'kind' = ?", "user_renamed")

</pre>
</div>
<h4 id="range-類型">1.5 Range 類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/rangetypes.html">類型定義</a></li>
<li><a href="http://www.postgresql.org/docs/9.3/static/functions-range.html">函數與運算元</a></li>
</ul>
<p>此類型映射到 Ruby 的 <a href="http://www.ruby-doc.org/core-2.1.1/Range.html"><code>Range</code></a> 物件</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20130923065404_create_events.rb
create_table :events do |t|
  t.daterange 'duration'
end

# app/models/event.rb
class Event &lt; ActiveRecord::Base
end

# 用途
Event.create(duration: Date.new(2014, 2, 11)..Date.new(2014, 2, 12))

event = Event.first
event.duration # =&gt; Tue, 11 Feb 2014...Thu, 13 Feb 2014

## 找出特定日期的所有活動
Event.where("duration @&gt; ?::date", Date.new(2014, 2, 12))

## 使用 range bounds
event = Event.
  select("lower(duration) AS starts_at").
  select("upper(duration) AS ends_at").first

event.starts_at # =&gt; Tue, 11 Feb 2014
event.ends_at # =&gt; Thu, 13 Feb 2014

</pre>
</div>
<h4 id="複合類型">1.6 複合類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/rowtypes.html">類型定義</a></li>
</ul>
<p>複合類型映射到一般的 <code>text</code> 欄位。</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
CREATE TYPE full_address AS
(
  city VARCHAR(90),
  street VARCHAR(90)
);

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20140207133952_create_contacts.rb
execute &lt;&lt;-SQL
 CREATE TYPE full_address AS
 (
   city VARCHAR(90),
   street VARCHAR(90)
 );
SQL
create_table :contacts do |t|
  t.column :address, :full_address
end

# app/models/contact.rb
class Contact &lt; ActiveRecord::Base
end

# 用途
Contact.create address: "(Paris,Champs-Élysées)"
contact = Contact.first
contact.address # =&gt; "(Paris,Champs-Élysées)"
contact.address = "(Paris,Rue Basse)"
contact.save!

</pre>
</div>
<h4 id="枚舉類型">1.7 枚舉類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-enum.html">類型定義</a></li>
</ul>
<p>枚舉類型映射到一般的 <code>text</code> 欄位。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_events.rb
execute &lt;&lt;-SQL
  CREATE TYPE article_status AS ENUM ('draft', 'published');
SQL
create_table :articles do |t|
  t.column :status, :article_status
end

# app/models/article.rb
class Article &lt; ActiveRecord::Base
end

# 用途
Article.create status: "draft"
article = Article.first
article.status # =&gt; "draft"

article.status = "published"
article.save!

</pre>
</div>
<h4 id="uuid-類型">1.8 UUID 類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-uuid.html">類型定義</a></li>
<li><a href="http://www.postgresql.org/docs/9.3/static/uuid-ossp.html">產生器函數</a></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_revisions.rb
create_table :revisions do |t|
  t.column :identifier, :uuid
end

# app/models/revision.rb
class Revision &lt; ActiveRecord::Base
end

# 用途
Revision.create identifier: "A0EEBC99-9C0B-4EF8-BB6D-6BB9BD380A11"

revision = Revision.first
revision.identifier # =&gt; "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"

</pre>
</div>
<h4 id="位元字串類型">1.9 位元字串類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-bit.html">類型定義</a></li>
<li><a href="http://www.postgresql.org/docs/9.3/static/functions-bitstring.html">函數與運算元</a></li>
</ul>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_users.rb
create_table :users, force: true do |t|
  t.column :settings, "bit(8)"
end

# app/models/device.rb
class User &lt; ActiveRecord::Base
end

# 用途
User.create settings: "01010011"
user = User.first
user.settings # =&gt; "(Paris,Champs-Élysées)"
user.settings = "0xAF"
user.settings # =&gt; 10101111
user.save!

</pre>
</div>
<h4 id="網路位址類型">1.10 網路位址類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-net-types.html">類型定義</a></li>
</ul>
<p><code>inet</code> 與 <code>cidr</code> 類型映射到 Ruby 的 <a href="http://www.ruby-doc.org/stdlib-2.1.1/libdoc/ipaddr/rdoc/IPAddr.html"><code>IPAddr</code></a> 物件。<code>macaddr</code> 類型映射到一般的 <code>text</code> 欄位。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20140508144913_create_devices.rb
create_table(:devices, force: true) do |t|
  t.inet 'ip'
  t.cidr 'network'
  t.macaddr 'address'
end

# app/models/device.rb
class Device &lt; ActiveRecord::Base
end

# Usage
macbook = Device.create(ip: "192.168.1.12",
                        network: "192.168.2.0/24",
                        address: "32:01:16:6d:05:ef")

macbook.ip
# =&gt; #&lt;IPAddr: IPv4:192.168.1.12/255.255.255.255&gt;

macbook.network
# =&gt; #&lt;IPAddr: IPv4:192.168.2.0/255.255.255.0&gt;

macbook.address
# =&gt; "32:01:16:6d:05:ef"

</pre>
</div>
<h4 id="幾何類型">1.11 幾何類型</h4>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/datatype-geometric.html">類型定義</a></li>
</ul>
<p>幾何類型映射到一般的 <code>text</code> 欄位。</p><h3 id="uuid-主鍵">2 UUID 主鍵</h3><div class="note"><p>需要啟用 <code>uuid-ossp</code> 擴充功能才可以產生 UUID。</p></div><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_devices.rb
enable_extension 'uuid-ossp' unless extension_enabled?('uuid-ossp')
create_table :devices, id: :uuid, default: 'uuid_generate_v4()' do |t|
  t.string :kind
end

# app/models/device.rb
class Device &lt; ActiveRecord::Base
end

# 用途
device = Device.create
device.id # =&gt; "814865cd-5a1d-4771-9306-4268f188fe9e"

</pre>
</div>
<h3 id="全文搜索">3 全文搜索</h3><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_documents.rb
create_table :documents do |t|
  t.string 'title'
  t.string 'body'
end

execute "CREATE INDEX documents_idx ON documents USING gin(to_tsvector('english', title || ' ' || body));"

# app/models/document.rb
class Document &lt; ActiveRecord::Base
end

# 用途
Document.create(title: "Cats and Dogs", body: "are nice!")

## 所有匹配 `cat &amp; dog` 的文件
Document.where("to_tsvector('english', title || ' ' || body) @@ to_tsquery(?)",
                 "cat &amp; dog")

</pre>
</div>
<h3 id="views">4 Views</h3>
<ul>
<li><a href="http://www.postgresql.org/docs/9.3/static/sql-createview.html">建立 View</a></li>
</ul>
<p>假設需要處理老舊的資料庫，資料表如下：</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
rails_pg_guide=# \d "TBL_ART"
                                        Table "public.TBL_ART"
   Column   |            Type             |                         Modifiers
------------+-----------------------------+------------------------------------------------------------
 INT_ID     | integer                     | not null default nextval('"TBL_ART_INT_ID_seq"'::regclass)
 STR_TITLE  | character varying           |
 STR_STAT   | character varying           | default 'draft'::character varying
 DT_PUBL_AT | timestamp without time zone |
 BL_ARCH    | boolean                     | default false
Indexes:
    "TBL_ART_pkey" PRIMARY KEY, btree ("INT_ID")

</pre>
</div>
<p>這張資料表完全沒有遵循 Rails 的慣例。
因為簡單的 PostgreSQL View 預設便可以更新了，可以像下面這樣包起來：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# db/migrate/20131220144913_create_articles_view.rb
execute &lt;&lt;-SQL
CREATE VIEW articles AS
  SELECT "INT_ID" AS id,
         "STR_TITLE" AS title,
         "STR_STAT" AS status,
         "DT_PUBL_AT" AS published_at,
         "BL_ARCH" AS archived
  FROM "TBL_ART"
  WHERE "BL_ARCH" = 'f'
  SQL

# app/models/article.rb
class Article &lt; ActiveRecord::Base
  self.primary_key = "id"
  def archive!
    update_attribute :archived, true
  end
end

# Usage
first = Article.create! title: "Winter is coming",
                        status: "published",
                        published_at: 1.year.ago
second = Article.create! title: "Brace yourself",
                         status: "draft",
                         published_at: 1.month.ago

Article.count # =&gt; 1
first.archive!
p Article.count # =&gt; 2

</pre>
</div>
<div class="note"><p>這個應用程式只專注在尚未歸檔的 <code>Articles</code>。View 也允許使用條件式，所以我們可以直接排除掉已歸檔的 <code>Articles</code>。</p></div>

        <h3>反饋</h3>
        <p>
          歡迎幫忙改善指南的品質。
        </p>
        <p>
          如發現任何錯誤之處，歡迎修正。開始貢獻前，可以先閱讀<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">貢獻指南：文件</a>。
        </p>
        <p>翻譯如有錯誤，深感抱歉，歡迎 <a href="https://github.com/docrails-tw/guides/fork">Fork</a> 修正，或至此處<a href="https://github.com/docsrails-tw/guides/issues/new">回報</a>。</p>
        <p>
          文章可能有未完成或過時的內容。請先檢查 <a href="http://edgeguides.rubyonrails.org">Edge Guides</a> 來確定問題在 master 是否已經修掉了。再上 master 補上缺少的文件。內容參考 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</a>來了解行文風格。
        </p>
        <p>最後，任何關於 Ruby on Rails 文件的討論，歡迎至 <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs 郵件論壇</a>。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本著作係採用<a href="https://creativecommons.org/licenses/by-sa/4.0/">創用 CC 姓名標示-相同方式分享 4.0 國際授權條款</a>授權。</p>
<p>“Rails”、“Ruby on Rails”，以及 Rails logo 為 David Heinemeier Hansson 的商標。版權所有。</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49903900-1', 'docrails-tw.github.io');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');

  </script>
</body>
</html>
