<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ruby on Rails 4.1 發佈記 — Ruby on Rails 指南</title>

  <link rel="stylesheet" href="stylesheets/application.css">

  <link href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700|Noto+Serif:700|Source+Code+Pro" rel="stylesheet">

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多內容 <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多內容
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">綜覽</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/download">下載</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/deploy">部署</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">原始碼</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/screencasts">影片</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/documentation">文件</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/community">社群</a></li>
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">Blog</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南目錄</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr>
              <dl class="L">
                <dt>起步走</dt>
                <dd><a href="getting_started.html">Rails 起步走</a></dd>
                <dt>Models</dt>
                <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                <dd><a href="active_record_migrations.html">Active Record 遷移</a></dd>
                <dd><a href="active_record_validations.html">Active Record 驗證</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record 回呼</a></dd>
                <dd><a href="association_basics.html">Active Record 關聯</a></dd>
                <dd><a href="active_record_querying.html">Active Record 查詢</a></dd>
                <dt>Views</dt>
                <dd><a href="layouts_and_rendering.html">Rails 算繪與版型</a></dd>
                <dd><a href="form_helpers.html">Action View 表單輔助方法</a></dd>
                <dt>Controllers</dt>
                <dd><a href="action_controller_overview.html">Action Controller 綜覽</a></dd>
                <dd><a href="routing.html">Rails 路由：深入淺出</a></dd>
              </dl>
              <dl class="R">
                <dt>深入了解</dt>
                <dd><a href="active_support_core_extensions.html">Active Support 核心擴展</a></dd>
                <dd><a href="i18n.html">Rails 國際化 API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer 基礎</a></dd>
                <dd><a href="security.html">Rails 安全指南</a></dd>
                <dd><a href="debugging_rails_applications.html">除錯 Rails 應用程式</a></dd>
                <dd><a href="configuring.html">Rails 應用程式設定</a></dd>
                <dd><a href="command_line.html">Rake 任務與 Rails 命令列工具</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">在 Rails 使用 JavaScript</a></dd>
                <dt>擴充 Rails</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                <dd><a href="generators.html">客製與新建 Rails 產生器</a></dd>
                <dd><a href="rails_application_templates.html">Rails 應用程式模版</a></dd>
                <dt>貢獻 Ruby on Rails</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">貢獻 Ruby on Rails</a></dd>
                <dd><a href="api_documentation_guidelines.html">API 文件準則</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</a></dd>
                <dt>維護方針</dt>
                <dd><a href="maintenance_policy.html">維護方針</a></dd>
                <dt>發佈記</dt>
                <dd><a href="upgrading_ruby_on_rails.html">升級 Ruby on Rails</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 發佈記</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 發佈記</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 發佈記</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 發佈記</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 發佈記</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 發佈記</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 發佈記</a></dd>
                <dt>Rails 指南翻譯術語</dt>
                <dd><a href="translation_terms.html">翻譯術語</a></dd>
              </dl>
          </div>
        </li>
        <!-- <li><a class="nav-item" href="//github.com/docrails-tw/wiki">參與翻譯</a></li> -->
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li><a class="nav-item" href="credits.html">致謝</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南目錄</option>
              <optgroup label="起步走">
                  <option value="getting_started.html">Rails 起步走</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="active_record_migrations.html">Active Record 遷移</option>
                  <option value="active_record_validations.html">Active Record 驗證</option>
                  <option value="active_record_callbacks.html">Active Record 回呼</option>
                  <option value="association_basics.html">Active Record 關聯</option>
                  <option value="active_record_querying.html">Active Record 查詢</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 算繪與版型</option>
                  <option value="form_helpers.html">Action View 表單輔助方法</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller 綜覽</option>
                  <option value="routing.html">Rails 路由：深入淺出</option>
              </optgroup>
              <optgroup label="深入了解">
                  <option value="active_support_core_extensions.html">Active Support 核心擴展</option>
                  <option value="i18n.html">Rails 國際化 API</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎</option>
                  <option value="security.html">Rails 安全指南</option>
                  <option value="debugging_rails_applications.html">除錯 Rails 應用程式</option>
                  <option value="configuring.html">Rails 應用程式設定</option>
                  <option value="command_line.html">Rake 任務與 Rails 命令列工具</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">在 Rails 使用 JavaScript</option>
              </optgroup>
              <optgroup label="擴充 Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">客製與新建 Rails 產生器</option>
                  <option value="rails_application_templates.html">Rails 應用程式模版</option>
              </optgroup>
              <optgroup label="貢獻 Ruby on Rails">
                  <option value="contributing_to_ruby_on_rails.html">貢獻 Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API 文件準則</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</option>
              </optgroup>
              <optgroup label="維護方針">
                  <option value="maintenance_policy.html">維護方針</option>
              </optgroup>
              <optgroup label="發佈記">
                  <option value="upgrading_ruby_on_rails.html">升級 Ruby on Rails</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 發佈記</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 發佈記</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 發佈記</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 發佈記</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 發佈記</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 發佈記</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 發佈記</option>
              </optgroup>
              <optgroup label="Rails 指南翻譯術語">
                  <option value="translation_terms.html">翻譯術語</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide">

  <div id="feature">
    <div class="wrapper">
      <h2>Ruby on Rails 4.1 發佈記</h2><p>Rails 4.1 精華摘要：</p>
<ul>
<li>採用 Spring 來預載應用程式</li>
<li><code>config/secrets.yml</code></li>
<li>Action Pack Variants</li>
<li>Action Mailer Preview</li>
</ul>
<p>本篇僅記錄主要的變化。要了解關於已修復的 Bug、功能變更等，請參考 [Rails GitHub 主頁][rails]上各個 Gem 的 CHANGELOG 或是 <a href="https://github.com/rails/rails/commits/master">Rails 的提交歷史</a>。</p>

                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#%E5%8D%87%E7%B4%9A%E8%87%B3-rails-4.1">升級至 Rails 4.1</a></li>
<li>
<a href="#%E4%B8%BB%E8%A6%81%E6%96%B0%E5%8A%9F%E8%83%BD">主要新功能</a>

<ul>
<li><a href="#%E6%87%89%E7%94%A8%E7%A8%8B%E5%BC%8F%E9%A0%90%E5%8A%A0%E8%BC%89%E5%99%A8%EF%BC%9Aspring">應用程式預加載器：Spring</a></li>
<li><a href="#config/secrets.yml"><code>config/secrets.yml</code></a></li>
<li><a href="#action-pack-variants">Action Pack Variants</a></li>
<li><a href="#action-mailer-%E9%A0%90%E8%A6%BD">Action Mailer 預覽</a></li>
<li><a href="#active-record-enums">Active Record enums</a></li>
<li><a href="#message-verifier-%E8%A8%8A%E6%81%AF%E9%A9%97%E8%AD%89%E5%99%A8">Message Verifier 訊息驗證器</a></li>
<li><a href="#module#concerning">Module#concerning</a></li>
<li><a href="#csrf-%E6%A9%9F%E5%88%B6%E6%96%B0%E5%A2%9E%E9%81%A0%E7%AB%AF-%3Cscript%3E-%E9%98%B2%E8%AD%B7%E3%80%82">CSRF 機制新增遠端 <code>&lt;script&gt;</code> 防護。</a></li>
</ul>
</li>
<li>
<a href="#railties">Railties</a>

<ul>
<li><a href="#railties-%E7%A7%BB%E9%99%A4">移除</a></li>
<li><a href="#railties-%E5%80%BC%E5%BE%97%E4%B8%80%E6%8F%90%E7%9A%84%E8%AE%8A%E5%8C%96">值得一提的變化</a></li>
</ul>
</li>
<li>
<a href="#action-pack">Action Pack</a>

<ul>
<li><a href="#action-pack-%E7%A7%BB%E9%99%A4">移除</a></li>
<li><a href="#action-pack-%E5%80%BC%E5%BE%97%E4%B8%80%E6%8F%90%E7%9A%84%E8%AE%8A%E5%8C%96">值得一提的變化</a></li>
</ul>
</li>
<li>
<a href="#action-mailer">Action Mailer</a>

<ul>
<li><a href="#action-mailer-%E5%80%BC%E5%BE%97%E4%B8%80%E6%8F%90%E7%9A%84%E8%AE%8A%E5%8C%96">值得一提的變化</a></li>
</ul>
</li>
<li>
<a href="#active-record">Active Record</a>

<ul>
<li><a href="#active-record-%E7%A7%BB%E9%99%A4">移除</a></li>
<li><a href="#active-record-%E6%A3%84%E7%94%A8">棄用</a></li>
<li><a href="#active-record-%E5%80%BC%E5%BE%97%E4%B8%80%E6%8F%90%E7%9A%84%E8%AE%8A%E5%8C%96">值得一提的變化</a></li>
</ul>
</li>
<li>
<a href="#active-model">Active Model</a>

<ul>
<li><a href="#active-model-%E6%A3%84%E7%94%A8">棄用</a></li>
<li><a href="#active-model-%E5%80%BC%E5%BE%97%E4%B8%80%E6%8F%90%E7%9A%84%E8%AE%8A%E5%8C%96">值得一提的變化</a></li>
</ul>
</li>
<li>
<a href="#active-support">Active Support</a>

<ul>
<li><a href="#active-support-%E7%A7%BB%E9%99%A4">移除</a></li>
<li><a href="#%E6%A3%84%E7%94%A8">棄用</a></li>
<li><a href="#active-support-%E5%80%BC%E5%BE%97%E4%B8%80%E6%8F%90%E7%9A%84%E8%AE%8A%E5%8C%96">值得一提的變化</a></li>
</ul>
</li>
<li><a href="#%E8%87%B4%E8%AC%9D">致謝</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="升級至-rails-4.1">1 升級至 Rails 4.1</h3><p>如果您正試著升級現有的應用程式，最好有廣的測試覆蓋度。首先應先升級至 4.0，確保應用程式仍正常工作，接著再升上 4.1。升級需要注意的事項在 <a href="upgrading_ruby_on_rails.html#upgrading-from-rails-4-0-to-rails-4-1">Ruby on Rails 升級指南</a>可以找到。</p><h3 id="主要新功能">2 主要新功能</h3><h4 id="應用程式預加載器：spring">2.1 應用程式預加載器：Spring</h4><p>Spring 會預加載你的 Rails 應用程式。保持應用程式在背景執行，如此一來在執行 Rails 命令時：如跑測試、<code>rake</code>、<code>migrate</code> 時，不用每次都重啟 Rails 應用程式，加速你的開發流程。</p><p>新版 Rails 4.1 應用程式出廠內建 “Spring 化” 的 binstubs（aka，執行檔，如 <code>rails</code>、<code>rake</code>）。這表示 <code>bin/rails</code>、<code>bin/rake</code> 會自動採用 Spring 預載的那一份 Rails。</p><p><strong>執行 rake task：</strong></p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
bin/rake test:models

</pre>
</div>
<p><strong>執行 console：</strong></p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
bin/rails console

</pre>
</div>
<p><strong>查看 Spring</strong></p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$ bin/spring status
Spring is running:

 1182 spring server | my_app | started 29 mins ago
 3656 spring app    | my_app | started 23 secs ago | test mode
 3746 spring app    | my_app | started 10 secs ago | development mode

</pre>
</div>
<p>請查閱 <a href="https://github.com/rails/spring/blob/master/README.md">Spring README</a> 了解所有功能。</p><p>參考 <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html">Ruby on Rails 升級指南</a>來了解如何在現有專案裡導入 Spring。</p><h4 id="config/secrets.yml">2.2 <code>config/secrets.yml</code>
</h4><p>Rails 4.1 採用新的 <code>secrets.yml</code>，產生在 <code>config/</code> 目錄。這個檔案預設存有應用程式的 <code>secret_key_base</code>，也可以用來存放其它 secrets，比如存放外部 API 需要用的 access keys。例子：</p><p><code>secrets.yml</code>:</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
development:
  secret_key_base: "3b7cd727ee24e8444053437c36cc66c3"
  some_api_key: "b2c299a4a7b2fe41b6b7ddf517604a1c34"

</pre>
</div>
<p>如何讀：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&gt; Rails.application.secrets
=&gt; "3b7cd727ee24e8444053437c36cc66c3"
&gt; Rails.application.secrets.some_api_key
=&gt; "SOMEKEY"

</pre>
</div>
<p>參考 <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html">Ruby on Rails 升級指南</a>來了解如何在現有專案裡導入此功能。</p><h4 id="action-pack-variants">2.3 Action Pack Variants</h4><p>針對手機、平板、桌上型電腦及瀏覽器，常需要 <code>render</code> 不同格式的模版：<code>html</code>、<code>json</code>、<code>xml</code>。</p><p><strong>Variant 簡化了這件事。</strong></p><p>Request variant 是一種特殊的 request 格式，像是 <code>:tablet</code>、<code>:phone</code> 或 <code>:desktop</code>。</p><p>可在 <code>before_action</code> 裡設定 Variant：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
request.variant = :tablet if request.user_agent =~ /iPad/

</pre>
</div>
<p>在 Controller <code>action</code> 裡，<code>respond_to</code> 特殊格式跟一般格式方法相同：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
respond_to do |format|
  format.html do |html|
    html.tablet # 會 render app/views/projects/show.html+tablet.erb
    html.phone { extra_setup; render ... }
  end
end

</pre>
</div>
<p>再給每個特殊格式提供對應的模版：</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
app/views/projects/show.html.erb
app/views/projects/show.html+tablet.erb
app/views/projects/show.html+phone.erb

</pre>
</div>
<p>Variant 定義也可用 inline 寫法來簡化：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
respond_to do |format|
  format.js         { render "trash" }
  format.html.phone { redirect_to progress_path }
  format.html.none  { render "trash" }
end

</pre>
</div>
<h4 id="action-mailer-預覽">2.4 Action Mailer 預覽</h4><p>Action Mailer Preview 提供你訪問特定 URL，來預覽 Email 信件。假設你有個 <code>Notifier</code> Mailer，則需要實現 <code>Notifier</code> 的 Preview Class，實作方法來返回信件內容：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class NotifierPreview &lt; ActionMailer::Preview
  def welcome
    Notifier.welcome(User.first)
  end
end

</pre>
</div>
<p>如此一來便可以訪問 <a href="http://localhost:3000/rails/mailers/notifier/welcome">http://localhost:3000/rails/mailers/notifier/welcome</a> 來預覽 Email。</p><p>所有可預覽的 Email 可在此找到：<a href="http://localhost:3000/rails/mailers%E3%80%82">http://localhost:3000/rails/mailers。</a></p><p>預設這些 preview class 產生在 <code>test/mailers/previews</code>、可以透過 <code>preview_path</code> 選項來調整存放的位置。</p><p>參見 <a href="http://api.rubyonrails.org/v4.1.0/classes/ActionMailer/Base.html#class-ActionMailer::Base-label-Previewing+emails">Action Mailer 的文件</a>來了解更多細節。</p><h4 id="active-record-enums">2.5 Active Record enums</h4><p>宣告一個 <code>enum</code> 屬性，將屬性映射到資料庫的整數，並可透過名字查詢出來：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Conversation &lt; ActiveRecord::Base
  enum status: [ :active, :archived ]
end

conversation.archived!
conversation.active? # =&gt; false
conversation.status  # =&gt; "archived"

Conversation.archived # =&gt; Relation for all archived Conversations

</pre>
</div>
<p>參見 <a href="http://api.rubyonrails.org/v4.1.0/classes/ActiveRecord/Enum.html">active_record/enum.rb</a> 來了解更多細節。</p><h4 id="message-verifier-訊息驗證器">2.6 Message Verifier 訊息驗證器</h4><p>訊息驗證器用來產生與驗證訊息，可以用來保護敏感資料（如 <code>remember_me</code> 的 token）傳輸的安全性。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
signed_token = Rails.application.message_verifier(:remember_me).generate(token)
Rails.application.message_verifier(:remember_me).verify(signed_token) # =&gt; token

Rails.application.message_verifier(:remember_me).verify(tampered_token)
# 拋出異常 ActiveSupport::MessageVerifier::InvalidSignature

</pre>
</div>
<h4 id="module#concerning">2.7 Module#concerning</h4><p>一種自然、輕量級的方式來拆分 Class 內的職責。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Todo &lt; ActiveRecord::Base
  concerning :EventTracking do
    included do
      has_many :events
    end

    def latest_event
      ...
    end

    private
      def some_internal_method
        ...
      end
  end
end

</pre>
</div>
<p>等同於以前要定義 <code>EventTracking</code> Module，<code>extend ActiveSupport::Concern</code>，再混入 (mixin) <code>Todo</code> Class。</p><p>參見 <a href="http://api.rubyonrails.org/v4.1.0/classes/Module/Concerning.html">Module#concerning</a> 來了解更多細節。</p><h4 id="csrf-機制新增遠端-&lt;script&gt;-防護。">2.8 CSRF 機制新增遠端 <code>&lt;script&gt;</code> 防護。</h4><p>Rails 的跨站偽造請求（CSRF）防護機制現在也會保護從第三方 JavaScript 來的 GET 請求了！這預防第三方網站引用你的 JavaScript，試圖竊取敏感資料。</p><p>這意味著任何訪問 <code>.js</code> URL 的測試會失敗（因為受 CSRF 保護），必須明確指定使用 <code>xhr</code> （<code>XmlHttpRequests</code>）。</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
post :create, format: :js

</pre>
</div>
<p>改寫為</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
xhr :post, :create, format: :js

</pre>
</div>
<h3 id="railties">3 Railties</h3><p>請參考 <a href="https://github.com/rails/rails/blob/4-1-stable/railties/CHANGELOG.md">CHANGELOG</a> 來了解更多細節。</p><h4 id="railties-移除">3.1 移除</h4>
<ul>
<li><p>移除了 <code>update:application_controller</code> rake task。</p></li>
<li><p>移除了 <code>Rails.application.railties.engines</code>。</p></li>
<li><p>Rails 移除了 <code>config.threadsafe!</code> 設定。</p></li>
<li><p>移除了 <code>ActiveRecord::Generators::ActiveModel#update_attributes</code>，
請改用 <code>ActiveRecord::Generators::ActiveModel#update</code>。</p></li>
<li><p>移除了 <code>config.whiny_nils</code> 設定。</p></li>
<li><p>移除了用來跑測試的兩個 task：<code>rake test:uncommitted</code> 與 <code>rake test:recent</code>。</p></li>
</ul>
<h4 id="railties-值得一提的變化">3.2 值得一提的變化</h4>
<ul>
<li><p><a href="https://github.com/rails/spring">Spring</a> 納入 Rails 4.1 應用程式的預設 Gem，列在 <code>Gemfile</code>
的 <code>group :development</code> 裡，production 環境不會安裝。<a href="https://github.com/rails/rails/pull/12958">PR#12958</a></p></li>
<li><p><code>BACKTRACE</code> 環境變數可看測試的完整 backtrace （沒有過濾敏感資料）。<a href="https://github.com/rails/rails/commit/84eac5dab8b0fe9ee20b51250e52ad7bfea36553">Commit</a></p></li>
<li><p>環境設定檔可設定 <code>MiddlewareStack#unshift</code>。 <a href="https://github.com/rails/rails/pull/12749">PR#12749</a></p></li>
<li><p>新增 <code>Application#message_verifier</code> 方法來回傳訊息驗證器。<a href="https://github.com/rails/rails/pull/12995">PR#12995</a></p></li>
<li><p>預設產生的 <code>test_helper.rb</code> 會 <code>require</code> <code>test_help.rb</code>，幫你把測試的資料庫與 <code>db/schema.rb</code> （或 <code>db/structure.sql</code>）同步。但發現尚未執行的 migration 與 schema 不一致時會拋出錯誤。錯誤拋出與否則是由這個設定決定：<code>config.active_record.maintain_test_schema = false</code>，參見此 <a href="https://github.com/rails/rails/pull/13528">PR#13528</a>。</p></li>
<li><p>引入一個方便的方法： <code>Rails.gem_version</code>，來回傳 <code>Gem::Version.new(Rails.version)</code> 的值，一個更加可靠的方式來做版本比對。 <a href="https://github.com/rails/rails/pull/14103">PR#14103</a></p></li>
</ul>
<h3 id="action-pack">4 Action Pack</h3><p>請參考 <a href="https://github.com/rails/rails/blob/4-1-stable/actionpack/CHANGELOG.md">CHANGELOG</a> 來了解更多細節。</p><h4 id="action-pack-移除">4.1 移除</h4>
<ul>
<li><p>移除了 Rails 針對整合測試的補救方案（fallback），請設定 <code>ActionDispatch.test_app</code>。</p></li>
<li><p>移除了 <code>config.page_cache_extension</code> 設定。</p></li>
<li><p>移除了 <code>ActionController::RecordIdentifier</code>，請改用 <code>ActionView::RecordIdentifier</code>。</p></li>
<li>
<p>更改 Action Controller 下列常數的名稱：</p>
<table>
<thead>
<tr>
<th style="text-align: left">移除</th>
<th style="text-align: left">繼任</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">ActionController::AbstractRequest</td>
<td style="text-align: left">ActionDispatch::Request</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Request</td>
<td style="text-align: left">ActionDispatch::Request</td>
</tr>
<tr>
<td style="text-align: left">ActionController::AbstractResponse</td>
<td style="text-align: left">ActionDispatch::Response</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Response</td>
<td style="text-align: left">ActionDispatch::Response</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Routing</td>
<td style="text-align: left">ActionDispatch::Routing</td>
</tr>
<tr>
<td style="text-align: left">ActionController::Integration</td>
<td style="text-align: left">ActionDispatch::Integration</td>
</tr>
<tr>
<td style="text-align: left">ActionController::IntegrationTest</td>
<td style="text-align: left">ActionDispatch::IntegrationTest</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h4 id="action-pack-值得一提的變化">4.2 值得一提的變化</h4>
<ul>
<li><p><code>protect_from_forgery</code> 現在也會預防跨站的 <code>&lt;script&gt;</code>。請更新測試，使用 <code>xhr :get, :foo, format: :js</code> 來取代 <code>get :foo, format: :js</code>。<a href="https://github.com/rails/rails/pull/13345">PR#13345</a></p></li>
<li><p><code>#url_for</code> 接受額外的 options，可將選項打包成 hash，放在陣列傳入。<a href="https://github.com/rails/rails/pull/9599">PR#9599</a></p></li>
<li><p>新增 <code>session#fetch</code> 方法，行為與 <a href="http://www.ruby-doc.org/core-2.0.0/Hash.html#method-i-fetch">Hash#fetch</a> 類似，差別在回傳值永遠會存回 session。 <a href="https://github.com/rails/rails/pull/12692">PR#12692</a></p></li>
<li><p>將 Action View 從 Action Pack 裡整個抽離出來。 <a href="https://github.com/rails/rails/pull/11032">PR#11032</a></p></li>
<li><p>記錄受 deep munge 影響的 key。 <a href="https://github.com/rails/rails/pull/13813">PR#13813</a></p></li>
<li><p>新設定： <code>config.action_dispatch.perform_deep_munge</code>。用來決定是不是要開啟 "deep munging" （deep munge 用來處理安全風險 CVE-2013-0155）。 <a href="https://github.com/rails/rails/pull/13188">PR#13188</a></p></li>
<li><p>新設定：<code>config.action_dispatch.cookies_serializer</code>。用來指定加密與簽署 cookie jars 的 serializer。 <a href="https://github.com/rails/rails/pull/13692">PR#13692</a> &amp; <a href="https://github.com/rails/rails/pull/13945">PR#13945</a> &amp; <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#cookies-serializer">更多資訊</a></p></li>
<li><p>新增 <code>render :plain</code>、<code>render :html</code> 以及 <code>render
:body</code>。 <a href="https://github.com/rails/rails/pull/14062">PR#14062</a> &amp; <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#rendering-content-from-string">更多資訊</a></p></li>
</ul>
<h3 id="action-mailer">5 Action Mailer</h3><p>請參考 <a href="https://github.com/rails/rails/blob/4-1-stable/actionmailer/CHANGELOG.md">CHANGELOG</a> 來了解更多細節。</p><h4 id="action-mailer-值得一提的變化">5.1 值得一提的變化</h4>
<ul>
<li><p>新增 Mailer 預覽信件功能（基於 37 Signals 公司所開發的 mail_view Gem。）<a href="https://github.com/rails/rails/commit/d6dec7fcb6b8fddf8c170182d4fe64ecfc7b2261">Commit</a></p></li>
<li><p> Action Mailer 產生 mail 的時間會寫到 log 裡。 <a href="https://github.com/rails/rails/pull/12556">PR#12556</a></p></li>
</ul>
<h3 id="active-record">6 Active Record</h3><p>請參考 <a href="https://github.com/rails/rails/blob/4-1-stable/activerecord/CHANGELOG.md">CHANGELOG</a> 來了解更多細節。</p><h4 id="active-record-移除">6.1 移除</h4>
<ul>
<li><p>移除了傳入 <code>nil</code> 至右列 <code>SchemaCache</code> 的方法：<code>primary_keys</code>、<code>tables</code>、<code>columns</code> 及 <code>columns_hash</code>。</p></li>
<li><p>從 <code>ActiveRecord::Migrator#migrate</code> 移除了 block filter。</p></li>
<li><p>從 <code>ActiveRecord::Migrator</code> 移除了 String constructor。</p></li>
<li><p>移除了 scope 沒傳 callable object 的用法。</p></li>
<li><p>移除了 <code>transaction_joinable=</code>，請改用 <code>begin_transaction</code> 搭配 <code>:joinable</code> 選項的組合。</p></li>
<li><p>移除了 <code>decrement_open_transactions</code>。</p></li>
<li><p>移除了 <code>increment_open_transactions</code>。</p></li>
<li><p>移除了 <code>PostgreSQLAdapter#outside_transaction?</code>，可用 <code>#transaction_open?</code> 來取代。</p></li>
<li><p>移除了 <code>ActiveRecord::Fixtures.find_table_name</code> 請改用 <code>ActiveRecord::Fixtures.default_fixture_model_name</code>。</p></li>
<li><p>從 <code>SchemaStatements</code> 移除了 <code>columns_for_remove</code>。</p></li>
<li><p>移除了 <code>SchemaStatements#distinct</code>。</p></li>
<li><p>將棄用的 <code>ActiveRecord::TestCase</code> 移到 Rails test 裡。</p></li>
<li><p>移除有 <code>:dependent</code> 選項的關聯傳入 <code>:restrict</code> 選項。</p></li>
<li><p>移除了 association 這幾個選項 <code>:delete_sql</code>、<code>:insert_sql</code>、<code>:finder_sql</code> 及 <code>:counter_sql</code>。</p></li>
<li><p>從 Column 移除了 <code>type_cast_code</code> 方法。</p></li>
<li><p>移除了 <code>ActiveRecord::Base#connection</code> 實體方法，請透過 Class 來使用。</p></li>
<li><p>移除了 <code>auto_explain_threshold_in_seconds</code> 的警告。</p></li>
<li><p>移除了 <code>Relation#count</code> 的 <code>:distinct</code> 選項。</p></li>
<li><p>移除了 <code>partial_updates</code>、<code>partial_updates?</code> 與 <code>partial_updates=</code>。</p></li>
<li><p>移除了 <code>scoped</code>。</p></li>
<li><p>移除了 <code>default_scopes?</code>。</p></li>
<li><p>移除了隱式的 join references。</p></li>
<li><p>移掉 <code>activerecord-deprecated_finders</code> gem 的相依性，請參考<a href="https://github.com/rails/activerecord-deprecated_finders#active-record-deprecated-finders">該 Gem 的 README</a> 來了解更多資訊。</p></li>
<li><p>移除了 <code>implicit_readonly</code>。請改用 <code>readonly</code> 方法，並將 record 明確標明為 <code>readonly</code>。 <a href="https://github.com/rails/rails/pull/10769">PR#10769</a></p></li>
</ul>
<h4 id="active-record-棄用">6.2 棄用</h4>
<ul>
<li><p>棄用了任何地方都沒用到的 <code>quoted_locking_column</code> 方法。</p></li>
<li><p>Rails 內部棄用了 <code>ConnectionAdapters::SchemaStatements#distinct</code>。 <a href="https://github.com/rails/rails/pull/10556">PR#10556</a></p></li>
<li><p>棄用 <code>rake db:test:*</code> 系列的 task，因為現在會自動設定好測試資料庫。參見 Railties 的發佈記。<a href="https://github.com/rails/rails/pull/13528">PR#13528</a></p></li>
<li><p>棄用了無用的 <code>ActiveRecord::Base.symbolized_base_class</code> 與 <code>ActiveRecord::Base.symbolized_sti_name</code>，且沒有替代方案。<a href="https://github.com/rails/rails/commit/97e7ca48c139ea5cce2fa9b4be631946252a1ebd">Commit</a></p></li>
</ul>
<h4 id="active-record-值得一提的變化">6.3 值得一提的變化</h4>
<ul>
<li>預設 scope 不會再被一連串的條件語句給覆蓋掉。</li>
</ul>
<p>  之前的行為：若在 Model 有定義 <code>default_scope</code>，則會被一連串的條件語句給覆蓋掉。現在會像其它 Scope 一樣合併。<a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#changes-on-default-scopes">更多細節</a></p>
<ul>
<li><p>新增 <code>ActiveRecord::Base.to_param</code> 來顯示漂亮的 URL。 <a href="https://github.com/rails/rails/pull/12891">PR#12891</a></p></li>
<li><p>新增 <code>ActiveRecord::Base.no_touching</code>，可允許忽略對 Model 的 touch。 <a href="https://github.com/rails/rails/pull/12772">PR#12772</a></p></li>
<li><p>統一了 <code>MysqlAdapter</code> 與 <code>Mysql2Adapter</code> 的布林轉換，<code>true</code> 會返回 <code>1</code>，<code>false</code> 返回 <code>0</code>。 <a href="https://github.com/rails/rails/pull/12425">PR#12425</a></p></li>
<li><p><code>unscope</code> 現在移除了 <code>default_scope</code> 規範的 conditions。<a href="https://github.com/rails/rails/commit/94924dc32baf78f13e289172534c2e71c9c8cade">Commit</a></p></li>
<li><p>新增 <code>ActiveRecord::QueryMethods#rewhere</code>，會覆寫已存在的 where 條件。<a href="https://github.com/rails/rails/commit/f950b2699f97749ef706c6939a84dfc85f0b05f2">Commit</a></p></li>
<li><p>擴充了 <code>ActiveRecord::Base#cache_key</code>，可接受多個 timestamp，會使用數值最大的 timestamp。<a href="https://github.com/rails/rails/commit/e94e97ca796c0759d8fcb8f946a3bbc60252d329">Commit</a></p></li>
<li><p>新增 <code>ActiveRecord::Base#enum</code>，用來枚舉 attributes。將 attributes 映射到資料庫的整數，並可透過名字查詢出來。<a href="https://github.com/rails/rails/commit/db41eb8a6ea88b854bf5cd11070ea4245e1639c5">Commit</a></p></li>
<li><p>寫入資料庫時，JSON 會做類型轉換。這樣子讀寫才會一致。 <a href="https://github.com/rails/rails/pull/12643">PR#12643</a></p></li>
<li><p>寫入資料庫時，hstore 會做類型轉換，這樣子讀寫才會一致。<a href="https://github.com/rails/rails/commit/5ac2341fab689344991b2a4817bd2bc8b3edac9d">Commit</a></p></li>
<li><p><code>next_migration_number</code> 可供第三方函式庫存取。 <a href="https://github.com/rails/rails/pull/12407">PR#12407</a></p></li>
<li><p>若是呼叫 <code>update_attributes</code> 的參數有 <code>nil</code>，則會拋出 <code>ArgumentError</code>。更精準的說，傳進來的參數，沒有回應(<code>respond_to</code>) <code>stringify_keys</code> 的話，會拋出錯誤。<a href="https://github.com/rails/rails/pull/9860">PR#9860</a></p></li>
<li><p><code>CollectionAssociation#first</code>/<code>#last</code> (<code>has_many</code>) ，Query 會使用 <code>LIMIT</code> 來限制提取的數量，而不是將整個 collection 載入出來。 <a href="https://github.com/rails/rails/pull/12137">PR#12137</a></p></li>
<li><p>對 Active Record Model 的類別做 <code>inspect</code> 不會去連資料庫。這樣當資料庫不存在時，<code>inspect</code> 才不會噴錯誤。<a href="https://github.com/rails/rails/pull/11014">PR#11014</a></p></li>
<li><p>移除了 <code>count</code> 的欄位限制，SQL 不正確時，讓資料庫自己丟出錯誤。 <a href="https://github.com/rails/rails/pull/10710">PR#10710</a></p></li>
<li><p>Rails 現在會自動偵測 inverse associations。如果 association 沒有設定 <code>:inverse_of</code>，則 Active Record 會自己猜出對應的 associaiton。<a href="https://github.com/rails/rails/pull/10886">PR#10886</a></p></li>
<li><p><code>ActiveRecord::Relation</code> 會處理有別名的 attributes。當使用符號作為 key 時，Active Record 現在也會一起翻譯別名的屬性了，將其轉成資料庫內所使用的欄位名。<a href="https://github.com/rails/rails/pull/7839">PR#7839</a></p></li>
<li><p>Fixtures 檔案中的 ERB 不在 main 物件上下文裡執行了，多個 fixtures 使用的 Helper ，需要定義在被 <code>ActiveRecord::FixtureSet.context_class</code> 包含的 Module 裡。 <a href="https://github.com/rails/rails/pull/13022">PR#13022</a></p></li>
<li><p>若明確指定了 <code>RAILS_ENV</code>，則不要建立或刪除資料庫。 <a href="https://github.com/rails/rails/pull/13629">PR#13629</a></p></li>
<li><p><code>Relation</code> 不再有像是 <code>#map!</code> 以及 <code>#delete_if</code> 的 mutator 方法。要使用這些方法之前，先呼叫 <code>#to_a</code>。 <a href="https://github.com/rails/rails/pull/13314">PR#13314</a></p></li>
<li><p><code>find_in_batches</code>、<code>find_each</code>、<code>Result#each</code> 以及 <code>Enumerable#index_by</code>，現在會回傳 <code>Enumerator</code>，可以用來計算 <code>size</code>。<a href="https://github.com/rails/rails/pull/13938">PR#13938</a></p></li>
<li><p><code>scope</code>、<code>enum</code> 以及 Associations 現在對“危險的”名稱會拋出警告。 <a href="https://github.com/rails/rails/pull/13450">PR#13450</a> &amp; <a href="https://github.com/rails/rails/pull/13896">PR#13896</a></p></li>
<li><p>確保 <code>second</code> 致 <code>fifth</code> 的 Finder 方法與 <code>first</code> 行為一致。 <a href="https://github.com/rails/rails/pull/13757">PR#13757</a></p></li>
<li><p><code>touch</code> 方法會觸發 <code>after_commit</code> 與 <code>after_rollback</code> Callbacks. <a href="https://github.com/rails/rails/pull/12031">PR#12031</a></p></li>
<li><p><code>sqlite &gt;= 3.8.0</code> 啟用 partial indexes。 <a href="https://github.com/rails/rails/pull/13350">PR#13350</a></p></li>
<li><p>讓 <code>change_column_null</code> 是可逆操作。<a href="https://github.com/rails/rails/commit/724509a9d5322ff502aefa90dd282ba33a281a96">Commit</a></p></li>
<li><p>加入一個 flag 來禁止資料庫遷移後的 schema dump。Production 環境預設為 <code>false</code>。 <a href="https://github.com/rails/rails/pull/13948">PR#13948</a></p></li>
</ul>
<h3 id="active-model">7 Active Model</h3><p>請參考 <a href="https://github.com/rails/rails/blob/4-1-stable/activemodel/CHANGELOG.md">CHANGELOG</a> 來了解更多細節。</p><h4 id="active-model-棄用">7.1 棄用</h4>
<ul>
<li>棄用了 <code>Validator#setup</code>。現在要手動在 Validator 的 constructor 裡處理。<a href="https://github.com/rails/rails/commit/7d84c3a2f7ede0e8d04540e9c0640de7378e9b3a">Commit</a>
</li>
</ul>
<h4 id="active-model-值得一提的變化">7.2 值得一提的變化</h4>
<ul>
<li><p><code>ActiveModel::Dirty</code> 加入新的 API：<code>reset_changes</code> 與 <code>changes_applied</code>，來控制改變的狀態。</p></li>
<li><p>定義 validation 可以指定多個 context。 <a href="https://github.com/rails/rails/pull/13754">PR#13754</a></p></li>
<li><p><code>attribute_changed?</code> 現在可以接受 hash，來檢查 attribute 是否從 <code>:from</code> 變到 <code>:to</code>。 <a href="https://github.com/rails/rails/pull/13131">PR#13131</a></p></li>
</ul>
<h3 id="active-support">8 Active Support</h3><p>請參考 <a href="https://github.com/rails/rails/blob/4-1-stable/activesupport/CHANGELOG.md">CHANGELOG</a> 來了解更多細節。</p><h4 id="active-support-移除">8.1 移除</h4>
<ul>
<li><p>移除對 <code>MultiJSON</code> Gem 的依賴。也就是說 <code>ActiveSupport::JSON.decode</code> 不再接受給 <code>MultiJSON</code> 的 hash 參數。<a href="https://github.com/rails/rails/pull/10576">PR#10576</a></p></li>
<li><p>移除了 <code>encode_json</code> hook，本來可以用來把 object 轉成 JSON。這個功能被抽成了 <a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> Gem，請參考 <a href="https://github.com/rails/rails/pull/12183">PR#12183</a> 與<a href="upgrading_ruby_on_rails.html#changes-in-json-handling">這裡</a>。</p></li>
<li><p>移除了 <code>ActiveSupport::JSON::Variable</code>。</p></li>
<li><p>移除了 <code>String#encoding_aware?</code>（<code>core_ext/string/encoding.rb</code>）。</p></li>
<li><p>移除了 <code>Module#local_constant_names</code> 請改用 <code>Module#local_constants</code>。</p></li>
<li><p>移除了 <code>DateTime.local_offset</code> 請改用 <code>DateTime.civil_from_format</code>。</p></li>
<li><p>移除了 <code>Logger</code> （<code>core_ext/logger.rb</code>）。</p></li>
<li><p>移除了 <code>Time#time_with_datetime_fallback</code>、<code>Time#utc_time</code> 與
<code>Time#local_time</code>，請改用 <code>Time#utc</code> 與 <code>Time#local</code>。</p></li>
<li><p>移除了 <code>Hash#diff</code>。</p></li>
<li><p>移除了 <code>Date#to_time_in_current_zone</code> 請改用 <code>Date#in_time_zone</code>。</p></li>
<li><p>移除了 <code>Proc#bind</code>。</p></li>
<li><p>移除了 <code>Array#uniq_by</code> 與 <code>Array#uniq_by!</code> 請改用 Ruby 原生的
<code>Array#uniq</code> 與 <code>Array#uniq!</code>。</p></li>
<li><p>移除了 <code>ActiveSupport::BasicObject</code> 請改用 <code>ActiveSupport::ProxyObject</code>。</p></li>
<li><p>移除了 <code>BufferedLogger</code>, 請改用 <code>ActiveSupport::Logger</code>。</p></li>
<li><p>移除了 <code>assert_present</code> 與 <code>assert_blank</code>，請改用 <code>assert
object.blank?</code> 與 <code>assert object.present?</code>。</p></li>
<li><p>Remove deprecated <code>#filter</code> method for filter objects, use the corresponding
method instead (e.g. <code>#before</code> for a before filter).</p></li>
<li><p>Removed 'cow' =&gt; 'kine' irregular inflection from default
inflections. (<a href="https://github.com/rails/rails/commit/c300dca9963bda78b8f358dbcb59cabcdc5e1dc9">Commit</a>)</p></li>
</ul>
<h4 id="棄用">8.2 棄用</h4>
<ul>
<li><p>棄用了 <code>Numeric#{ago,until,since,from_now}</code>，要明確的將數值轉成 <code>AS::Duration</code>。比如 <code>5.ago</code> 請改成 <code>5.seconds.ago</code>。 <a href="https://github.com/rails/rails/pull/12389">PR#12389</a></p></li>
<li><p>引用路徑裡棄用了 <code>active_support/core_ext/object/to_json</code>。請改用<code>active_support/core_ext/object/json</code> 來取代。 <a href="https://github.com/rails/rails/pull/12203">PR#12203</a></p></li>
<li><p>棄用了 <code>ActiveSupport::JSON::Encoding::CircularReferenceError</code>。這個功能被抽成了<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> Gem，請參考 <a href="https://github.com/rails/rails/pull/%2012183">PR#12183</a> 與<a href="upgrading_ruby_on_rails.html#changes-in-json-handling">這裡</a>。</p></li>
<li><p>棄用了 <code>ActiveSupport.encode_big_decimal_as_string</code> 選項。這個功能被抽成了<a href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a> Gem，請參考 <a href="https://github.com/rails/rails/pull/%2012183">PR#12183</a> 與<a href="upgrading_ruby_on_rails.html#changes-in-json-handling">這裡</a>。</p></li>
<li><p>棄用自訂的 <code>BigDecimal</code>
serialization。 <a href="https://github.com/rails/rails/pull/13911">PR#13911</a></p></li>
</ul>
<h4 id="active-support-值得一提的變化">8.3 值得一提的變化</h4>
<ul>
<li><p>使用 JSON gem 重寫 ActiveSupport 的 JSON Encoding 部分，提升了純 Ruby 編碼的效率。參考 <a href="https://github.com/rails/rails/pull/12183">PR#12183</a> 與<a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#changes-in-json-handling">這裡</a>。</p></li>
<li><p>提升 JSON gem 相容性。 <a href="https://github.com/rails/rails/pull/12862">PR#12862</a> 與<a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#changes-in-json-handling">這裡</a></p></li>
<li><p>新增 <code>ActiveSupport::Testing::TimeHelpers#travel</code> 與 <code>#travel_to</code>。這些方法透過 stubbing <code>Time.now</code> 與 <code>Date.today</code>，可設定任何時間，坐時光旅行。</p></li>
<li><p>新增 <code>ActiveSupport::Testing::TimeHelpers#travel_back</code>。這個方法將當下時間回到原本的狀態。透過移除 <code>travel</code> 與 <code>travel_to</code> 加入的 stubs 辦到。 <a href="https://github.com/rails/rails/pull/13884">PR#13884</a></p></li>
<li><p>新增 <code>Numeric#in_milliseconds</code>，像是 1 小時有幾毫秒：<code>1.hour.in_milliseconds</code>。可以將時間轉成毫秒，再餵給 JavaScript 的 <code>getTime()</code> 函式。<a href="https://github.com/rails/rails/commit/423249504a2b468d7a273cbe6accf4f21cb0e643">Commit</a></p></li>
<li><p>新增了 <code>Date#middle_of_day</code>、<code>DateTime#middle_of_day</code> 與 <code>Time#middle_of_day</code>
方法。同時添加了 <code>midday</code>、<code>noon</code>、<code>at_midday</code>、<code>at_noon</code>、<code>at_middle_of_day</code> 作為別名。<a href="https://github.com/rails/rails/pull/10879">PR#10879</a></p></li>
<li><p>新增 <code>Date#all_week/month/quarter/year</code> 用來產生一組日期範圍。  <a href="https://github.com/rails/rails/pull/9685">PR#9685</a></p></li>
<li><p>新增 <code>Time.zone.yesterday</code> 以及
<code>Time.zone.tomorrow</code>。 <a href="https://github.com/rails/rails/pull/12822">PR#12822</a></p></li>
<li><p><code>String#gsub(pattern,'')</code> 可簡寫為 <code>String#remove(pattern)</code>。<a href="https://github.com/rails/rails/commit/5da23a3f921f0a4a3139495d2779ab0d3bd4cb5f">Commit</a></p></li>
<li><p>新增 <code>Hash#compact</code> 與 <code>Hash#compact!</code> 來移除 hash 中的 nil。 <a href="https://github.com/rails/rails/pull/13632">PR#13632</a></p></li>
<li><p><code>blank?</code> and <code>present?</code> 會返回 singleton。 (<a href="https://github.com/rails/rails/commit/126dc47665c65cd129967cbd8a5926dddd0aa514">Commit</a>)</p></li>
<li><p>新的設定： <code>I18n.enforce_available_locales</code> 預設是 <code>true</code>。代表 <code>I18n</code> 會確保所有傳入的 locale 都預先在 <code>available_locales</code> 裡宣告。 <a href="https://github.com/rails/rails/pull/13341">PR#13341</a></p></li>
<li><p>引入 <code>Module#concerning</code>：一種自然、輕量級的方式來拆分 Class 內的職責。<a href="https://github.com/rails/rails/commit/1eee0ca6de975b42524105a59e0521d18b38ab81">Commit</a></p></li>
<li><p>新增 <code>Object#presence_in</code> 來簡化對數值做白名單。<a href="https://github.com/rails/rails/commit/4edca106daacc5a159289eae255207d160f22396">Commit</a></p></li>
</ul>
<h3 id="致謝">9 致謝</h3><p>許多人花了寶貴的時間貢獻至 Rails 專案，使 Rails 成為更穩定、更強韌的網路框架，參考<a href="http://contributors.rubyonrails.org/">完整的 Rails 貢獻者清單</a>，感謝所有的貢獻者！</p>

        <h3>反饋</h3>
        <p>
          歡迎幫忙改善指南的品質。
        </p>
        <p>
          如發現任何錯誤之處，歡迎修正。開始貢獻前，可以先閱讀<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">貢獻指南：文件</a>。
        </p>
        <p>翻譯如有錯誤，深感抱歉，歡迎 <a href="https://github.com/docrails-tw/guides/fork">Fork</a> 修正，或至此處<a href="https://github.com/docsrails-tw/guides/issues/new">回報</a>。</p>
        <p>
          文章可能有未完成或過時的內容。請先檢查 <a href="http://edgeguides.rubyonrails.org">Edge Guides</a> 來確定問題在 master 是否已經修掉了。再上 master 補上缺少的文件。內容參考 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</a>來了解行文風格。
        </p>
        <p>最後，任何關於 Ruby on Rails 文件的討論，歡迎至 <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs 郵件論壇</a>。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide">
  <div id="footer">
    <div class="wrapper">
      <p>本著作係採用<a href="https://creativecommons.org/licenses/by-sa/4.0/">創用 CC 姓名標示-相同方式分享 4.0 國際授權條款</a>授權。</p>
<p>“Rails”、“Ruby on Rails”，以及 Rails logo 為 David Heinemeier Hansson 的商標。版權所有。</p>

    </div>
  </div>

  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/responsive-tables.js"></script>
  <script src="javascripts/guides.js"></script>
  <script src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,"script","//www.google-analytics.com/analytics.js","ga");

    ga("create", "UA-49903900-1", "docrails-tw.github.io");
    ga("require", "displayfeatures");
    ga("send", "pageview");

  </script>
</body>
</html>
