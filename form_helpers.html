<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-TW" lang="zh-TW">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Action View 表單輔助方法 — Ruby on Rails 指南</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">更多內容 <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        更多內容
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">綜覽</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/download">下載</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/deploy">部署</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">原始碼</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/screencasts">影片</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/documentation">文件</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/community">社群</a></li>
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">Blog</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="回首頁">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">首頁</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">指南目錄</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>起步走</dt>
                <dd><a href="getting_started.html">Rails 入門指南</a></dd>
                <dt>Models</dt>
                <dd><a href="active_record_basics.html">Active Record 基礎</a></dd>
                <dd><a href="migrations.html">Active Record 遷移</a></dd>
                <dd><a href="active_record_validations.html">Active Record 驗證</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record 回呼</a></dd>
                <dd><a href="association_basics.html">Active Record 關聯</a></dd>
                <dd><a href="active_record_querying.html">Active Record 查詢</a></dd>
                <dt>Views</dt>
                <dd><a href="layouts_and_rendering.html">Rails 算繪與版型</a></dd>
                <dd><a href="form_helpers.html">Action View 表單輔助方法</a></dd>
                <dt>Controllers</dt>
                <dd><a href="action_controller_overview.html">Action Controller 綜覽</a></dd>
                <dd><a href="routing.html">Rails 路由：深入淺出</a></dd>
              </dl>
              <dl class="R">
                <dt>深入了解</dt>
                <dd><a href="active_support_core_extensions.html">Active Support 核心擴展</a></dd>
                <dd><a href="i18n.html">Rails 國際化 API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer 基礎</a></dd>
                <dd><a href="security.html">Rails 安全指南</a></dd>
                <dd><a href="debugging_rails_applications.html">Rails 應用程式除錯</a></dd>
                <dd><a href="configuring.html">Rails 設定應用程式</a></dd>
                <dd><a href="command_line.html">Rake 任務與 Rails 命令行工具</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">在 Rails 使用 JavaScript</a></dd>
                <dt>擴充 Rails</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                <dd><a href="generators.html">客製與新建 Rails 產生器</a></dd>
                <dt>貢獻至 Ruby on Rails</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">貢獻至 Ruby on Rails</a></dd>
                <dd><a href="api_documentation_guidelines.html">API 文件準則</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</a></dd>
                <dt>維護方針</dt>
                <dd><a href="maintenance_policy.html">維護方針</a></dd>
                <dt>發佈記</dt>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 發佈記</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 發佈記</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 發佈記</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 發佈記</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 發佈記</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 發佈記</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 發佈記</a></dd>
              </dl>
          </div>
        </li>
        <!-- <li><a class="nav-item" href="//github.com/docrails-tw/wiki">參與翻譯</a></li> -->
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">貢獻</a></li>
        <li><a class="nav-item" href="credits.html">致謝</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">指南目錄</option>
              <optgroup label="起步走">
                  <option value="getting_started.html">Rails 入門指南</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record 基礎</option>
                  <option value="migrations.html">Active Record 遷移</option>
                  <option value="active_record_validations.html">Active Record 驗證</option>
                  <option value="active_record_callbacks.html">Active Record 回呼</option>
                  <option value="association_basics.html">Active Record 關聯</option>
                  <option value="active_record_querying.html">Active Record 查詢</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Rails 算繪與版型</option>
                  <option value="form_helpers.html">Action View 表單輔助方法</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller 綜覽</option>
                  <option value="routing.html">Rails 路由：深入淺出</option>
              </optgroup>
              <optgroup label="深入了解">
                  <option value="active_support_core_extensions.html">Active Support 核心擴展</option>
                  <option value="i18n.html">Rails 國際化 API</option>
                  <option value="action_mailer_basics.html">Action Mailer 基礎</option>
                  <option value="security.html">Rails 安全指南</option>
                  <option value="debugging_rails_applications.html">Rails 應用程式除錯</option>
                  <option value="configuring.html">Rails 設定應用程式</option>
                  <option value="command_line.html">Rake 任務與 Rails 命令行工具</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">在 Rails 使用 JavaScript</option>
              </optgroup>
              <optgroup label="擴充 Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">客製與新建 Rails 產生器</option>
              </optgroup>
              <optgroup label="貢獻至 Ruby on Rails">
                  <option value="contributing_to_ruby_on_rails.html">貢獻至 Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API 文件準則</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</option>
              </optgroup>
              <optgroup label="維護方針">
                  <option value="maintenance_policy.html">維護方針</option>
              </optgroup>
              <optgroup label="發佈記">
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 發佈記</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 發佈記</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 發佈記</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 發佈記</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 發佈記</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 發佈記</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 發佈記</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Action View 表單輔助方法</h2><p>表單是 Web 應用程式裡，供使用者輸入的基本介面。然而表單的各種名稱與屬性，撰寫表單很快便變得繁瑣與難以維護。Rails 透過提供 View 輔助方法，來簡化表單的撰寫。但各種輔助方法的應用場景不盡相同，開發者需要知道輔助方法之間的差異，才能完善的使用這些輔助方法。</p><p>讀完本篇，您將了解：</p>
<ul>
<li>如何建立搜索表單與其它常見的通用表單。</li>
<li>如何替 Model 打造出編輯與建立資料庫記錄的表單。</li>
<li>如何從多種類型的資料產生 select boxes。</li>
<li>Rails 提供的日期與時間輔助方法。</li>
<li>上傳檔案表單的特別之處。</li>
<li>打造供外部資源使用的表單。</li>
<li>如何打造複雜表單。</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#%E8%99%95%E7%90%86%E7%B0%A1%E5%96%AE%E7%9A%84%E8%A1%A8%E5%96%AE">處理簡單的表單</a>

<ul>
<li><a href="#%E9%80%9A%E7%94%A8%E6%90%9C%E7%B4%A2%E8%A1%A8%E5%96%AE">通用搜索表單</a></li>
<li><a href="#%E5%91%BC%E5%8F%AB%E8%A1%A8%E5%96%AE%E8%BC%94%E5%8A%A9%E6%96%B9%E6%B3%95%E5%90%8C%E6%99%82%E5%82%B3%E5%A4%9A%E5%80%8B-hash">呼叫表單輔助方法同時傳多個 Hash</a></li>
<li><a href="#%E7%94%A2%E7%94%9F%E8%A1%A8%E5%96%AE%E5%85%83%E7%B4%A0%E7%9A%84%E8%BC%94%E5%8A%A9%E6%96%B9%E6%B3%95">產生表單元素的輔助方法</a></li>
<li><a href="#%E5%85%B6%E5%AE%83%E7%9B%B8%E9%97%9C%E8%BC%94%E5%8A%A9%E6%96%B9%E6%B3%95">其它相關輔助方法</a></li>
</ul>
</li>
<li>
<a href="#%E8%99%95%E7%90%86-model-%E7%89%A9%E4%BB%B6">處理 Model 物件</a>

<ul>
<li><a href="#model-%E7%89%A9%E4%BB%B6%E8%BC%94%E5%8A%A9%E6%96%B9%E6%B3%95">Model 物件輔助方法</a></li>
<li><a href="#%E5%B0%87%E8%A1%A8%E5%96%AE%E7%B6%81%E5%AE%9A%E5%88%B0%E7%89%A9%E4%BB%B6">將表單綁定到物件</a></li>
<li><a href="#relying-on-record-identification">Relying on Record Identification</a></li>
<li><a href="#how-do-forms-with-patch,-put,-or-delete-methods-work-questionmark">How do forms with PATCH, PUT, or DELETE methods work?</a></li>
</ul>
</li>
<li>
<a href="#making-select-boxes-with-ease">Making Select Boxes with Ease</a>

<ul>
<li><a href="#the-select-and-option-tags">The Select and Option Tags</a></li>
<li><a href="#select-boxes-for-dealing-with-models">Select Boxes for Dealing with Models</a></li>
<li><a href="#option-tags-from-a-collection-of-arbitrary-objects">Option Tags from a Collection of Arbitrary Objects</a></li>
<li><a href="#time-zone-and-country-select">Time Zone and Country Select</a></li>
</ul>
</li>
<li>
<a href="#using-date-and-time-form-helpers">Using Date and Time Form Helpers</a>

<ul>
<li><a href="#barebones-helpers">Barebones Helpers</a></li>
<li><a href="#model-object-helpers">Model Object Helpers</a></li>
<li><a href="#common-options">Common Options</a></li>
<li><a href="#individual-components">Individual Components</a></li>
</ul>
</li>
<li>
<a href="#uploading-files">Uploading Files</a>

<ul>
<li><a href="#what-gets-uploaded">What Gets Uploaded</a></li>
<li><a href="#dealing-with-ajax">Dealing with Ajax</a></li>
</ul>
</li>
<li><a href="#customizing-form-builders">Customizing Form Builders</a></li>
<li>
<a href="#understanding-parameter-naming-conventions">Understanding Parameter Naming Conventions</a>

<ul>
<li><a href="#basic-structures">Basic Structures</a></li>
<li><a href="#combining-them">Combining Them</a></li>
<li><a href="#using-form-helpers">Using Form Helpers</a></li>
</ul>
</li>
<li><a href="#forms-to-external-resources">Forms to external resources</a></li>
<li>
<a href="#building-complex-forms">Building Complex Forms</a>

<ul>
<li><a href="#configuring-the-model">Configuring the Model</a></li>
<li><a href="#nested-forms">Nested Forms</a></li>
<li><a href="#the-controller">The Controller</a></li>
<li><a href="#removing-objects">Removing Objects</a></li>
<li><a href="#preventing-empty-records">Preventing Empty Records</a></li>
<li><a href="#adding-fields-on-the-fly">Adding Fields on the Fly</a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <div class="note"><p>本篇不是表單輔助方法完整的文件，完整文件請參考 <a href="http://api.rubyonrails.org/">Rails API 文件</a>。</p></div><h3 id="處理簡單的表單">1 處理簡單的表單</h3><p>最基本的表單輔助方法是 <code>form_tag</code>。</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_tag do %&gt;
  Form contents
&lt;% end %&gt;

</pre>
</div>
<p>像這樣不傳參數呼叫時，會建立出 <code>&lt;form&gt;</code> 標籤。按下送出時，會對目前的頁面做 POST。舉例來說，假設目前的頁面是 <code>/home/index</code>，上例產生的 HTML 會像是（加了某些斷行提高可讀性）：</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form accept-charset="UTF-8" action="/home/index" method="post"&gt;
  &lt;div style="display:none"&gt;
    &lt;input name="utf8" type="hidden" value="&amp;#x2713;" /&gt;
    &lt;input name="authenticity_token" type="hidden" value="f755bb0ed134b76c432144748a6d4b7a7ddf2b71" /&gt;
  &lt;/div&gt;
  Form contents
&lt;/form&gt;

</pre>
</div>
<p>注意到 HTML 裡有個額外的 <code>div</code> 元素，裡面有兩個隱藏的 <code>input</code>。這個 <code>div</code> 很重要，沒有這個 <code>div</code> 表單便無法順利送出。第一個 <code>name</code> 屬性為 <code>utf8</code> 的 <code>input</code>，強制瀏覽器正確採用表單指定的編碼，所有 HTTP 動詞為 GET 或 POST 表單，Rails 都會產生這個 input。第二個 <code>name</code> 屬性為 <code>authenticity_token</code> 的 <code>input</code>，是 Rails 內建用來防止 CSRF (cross-site request forgery protection) 攻擊的安全機制，任何非 GET 的表單，Rails 都會產生一個這樣的 <code>input</code>（安全機制有啟用的話）。詳情請閱讀[安全指南](./security.html#cross-site-request-forgery-csrf。</p><div class="note"><p>為求行文簡潔，有隱藏輸入的 <code>div</code> 將省略不列在之後的範例裡。</p></div><h4 id="通用搜索表單">1.1 通用搜索表單</h4><p>Web 世界最基本的表單之一是「搜索表單」。通常由以下元素組成：</p>
<ul>
<li>一個有 GET 動詞的表單</li>
<li>供輸入的文字欄位</li>
<li>輸入有標籤</li>
<li>送出元素</li>
</ul>
<p> form_tag、label_tag、text_field_tag、
要建立搜索表單，可以使用 <code>form_tag</code>、<code>label_tag</code>、<code>text_field_tag</code> 以及 <code>submit_tag</code>：</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_tag("/search", method: "get") do %&gt;
  &lt;%= label_tag(:q, "Search for:") %&gt;
  &lt;%= text_field_tag(:q) %&gt;
  &lt;%= submit_tag("Search") %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>會產生出如下 HTML：</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form accept-charset="UTF-8" action="/search" method="get"&gt;&lt;div style="display:none"&gt;&lt;input name="utf8" type="hidden" value="&amp;#x2713;" /&gt;&lt;/div&gt;
  &lt;label for="q"&gt;Search for:&lt;/label&gt;
  &lt;input id="q" name="q" type="text" /&gt;
  &lt;input name="commit" type="submit" value="Search" /&gt;
&lt;/form&gt;

</pre>
</div>
<div class="info"><p>每個表單的輸入 <code>input</code>，都會根據 <code>name</code> 屬性來產生 ID 屬性（上例為 <code>q</code>）。ID 給 CSS 新增樣式、或是 JavaScript 操作表單都很方便。</p></div><p>除了 <code>text_field_tag</code> 與 <code>submit_tag</code> 之外，每個表單元素都有對應的輔助方法。</p><div class="warning"><p>搜索表單永遠使用 GET 動詞。這允許使用者可以把搜索結果加入書籤，之後能透過書籤瀏覽。Rails 普遍鼓勵使用正確的 HTTP 動詞。</p></div><h4 id="呼叫表單輔助方法同時傳多個-hash">1.2 呼叫表單輔助方法同時傳多個 Hash</h4><p><code>form_tag</code> 輔助方法接受 2 個參數： 表單送出的目標路徑，以及 Hash 選項。Hash 選項用來指定表單所使用的方法，以及其它 HTML 選項，如指定表單的 <code>class</code>。</p><p>和 <code>link_to</code> 輔助方法類似，路徑不需要是字串。可以是 Rails Router 看的懂的 URL Hash，Rails 的路由機制會把 Hash 轉換為有效的 URL。但由於傳給 <code>form_tag</code> 的兩個參數都是 Hash 時，兩個同時指定會碰到問題。請看以下這個例子：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
form_tag(controller: "people", action: "search", method: "get", class: "nifty_form")
# =&gt; '&lt;form accept-charset="UTF-8" action="/people/search?class=nifty_form&amp;amp;method=get" method="post"&gt;'

</pre>
</div>
<p>這裡 <code>method</code> 與 <code>class</code> 變成了產生出來的 URL 的查詢字串，因為 Rails 將這四個參數認成了一個 Hash。需要把第一組 Hash 放在大括號裡（或兩組明確使用大括號亦可），才會產生出正確的 HTML：</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
form_tag({ controller: "people", action: "search" }, method: "get", class: "nifty_form")
# =&gt; '&lt;form accept-charset="UTF-8" action="/people/search" class="nifty_form" method="get"&gt;'

</pre>
</div>
<h4 id="產生表單元素的輔助方法">1.3 產生表單元素的輔助方法</h4><p>Rails 提供一系列的輔助方法，用來產生表單元素，像是多選方框（checkboxes）、文字欄位（text fields）以及單選按鈕（radio button）。名字以 <code>_tag</code> 結尾的輔助方法（譬如 <code>text_field_tag</code> 與 <code>check_box_tag</code>）只會產生一個 <code>&lt;input&gt;</code> 元素。這些輔助方法的第一個參數都是 <code>input</code> 的名稱（name）。表單送出時，<code>name</code> 會與表單資料一起送出，使用者輸入的資料會存在 <code>params</code> Hash 裡，可在 Controller 取用。舉個例子，若表單的 <code>input</code> 是 <code>&lt;%= text_field_tag(:query) %&gt;</code>，則可在 Controller 用 <code>params[:query]</code> 來獲得使用者的輸入。</p><p>Rails 使用特定的慣例來命名 <code>input</code>，使得送出像是陣列與 Hash 的值，也可以在 <code>params</code> 裡取用。了解更多可閱讀本文第七章：<a href="#%E7%90%86%E8%A7%A3%E5%8F%83%E6%95%B8%E5%91%BD%E5%90%8D%E6%85%A3%E4%BE%8B">理解參數命名慣例</a>。這些輔助方法更精確的用途，請參考 <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/FormTagHelper.html">API 文件</a>。</p><h5 id="多選方框">1.3.1 多選方框</h5><p>多選方框是一種表單控件，給使用者一組可啟用停用的選項：</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= check_box_tag(:pet_dog) %&gt;
&lt;%= label_tag(:pet_dog, "I own a dog") %&gt;
&lt;%= check_box_tag(:pet_cat) %&gt;
&lt;%= label_tag(:pet_cat, "I own a cat") %&gt;

</pre>
</div>
<p>會產生出如下 HTML：</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="pet_dog" name="pet_dog" type="checkbox" value="1" /&gt;
&lt;label for="pet_dog"&gt;I own a dog&lt;/label&gt;
&lt;input id="pet_cat" name="pet_cat" type="checkbox" value="1" /&gt;
&lt;label for="pet_cat"&gt;I own a cat&lt;/label&gt;

</pre>
</div>
<p><code>checkbox_box_tag</code> 第一個參數是 <code>input</code> 的 <code>name</code>，第二個參數通常是 <code>input</code> 的 <code>value</code>，當該多選方框被選中時，<code>value</code> 會被包含在表單資料一併送出，便可在 <code>params</code> 取用。</p><h5 id="radio-buttons">1.3.2 Radio Buttons</h5><p>單選按鈕與多選方框類似，但每個選項是互斥的（也就是只能選一個）：</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= radio_button_tag(:age, "child") %&gt;
&lt;%= label_tag(:age_child, "I am younger than 21") %&gt;
&lt;%= radio_button_tag(:age, "adult") %&gt;
&lt;%= label_tag(:age_adult, "I'm over 21") %&gt;

</pre>
</div>
<p>會產生出如下 HTML：</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="age_child" name="age" type="radio" value="child" /&gt;
&lt;label for="age_child"&gt;I am younger than 21&lt;/label&gt;
&lt;input id="age_adult" name="age" type="radio" value="adult" /&gt;
&lt;label for="age_adult"&gt;I'm over 21&lt;/label&gt;

</pre>
</div>
<p>和 <code>check_box_tag</code> 類似，<code>radio_button_tag</code> 的第二個參數同樣是 <code>input</code> 的 <code>value</code>。因為這兩個單選按鈕的 <code>name</code> 都是 <code>age</code>，使用者只能選一個， <code>params[:age]</code> 的值會是 <code>"child"</code> 或 <code>"adult"</code>。</p><div class="note"><p>永遠記得幫多選方框與單選按鈕加上 <code>label</code>。<code>label</code> 可以為特定的輸入新增說明文字，也會加大可按範圍，讓使用者更容易選中。</p></div><h4 id="其它相關輔助方法">1.4 其它相關輔助方法</h4><p>其它值得一提的表單控件有：textareas、password fields、hidden fields、search fields、telephone fields、date fields、time fields、color fields、datetime fields、datetime-local fields、month fields、week fields、url fields、email fields、number fields 以及 range fields：</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= text_area_tag(:message, "Hi, nice site", size: "24x6") %&gt;
&lt;%= password_field_tag(:password) %&gt;
&lt;%= hidden_field_tag(:parent_id, "5") %&gt;
&lt;%= search_field(:user, :name) %&gt;
&lt;%= telephone_field(:user, :phone) %&gt;
&lt;%= date_field(:user, :born_on) %&gt;
&lt;%= datetime_field(:user, :meeting_time) %&gt;
&lt;%= datetime_local_field(:user, :graduation_day) %&gt;
&lt;%= month_field(:user, :birthday_month) %&gt;
&lt;%= week_field(:user, :birthday_week) %&gt;
&lt;%= url_field(:user, :homepage) %&gt;
&lt;%= email_field(:user, :address) %&gt;
&lt;%= color_field(:user, :favorite_color) %&gt;
&lt;%= time_field(:task, :started_at) %&gt;
&lt;%= number_field(:product, :price, in: 1.0..20.0, step: 0.5) %&gt;
&lt;%= range_field(:product, :discount, in: 1..100) %&gt;

</pre>
</div>
<p>產生的 HTML：</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;textarea id="message" name="message" cols="24" rows="6"&gt;Hi, nice site&lt;/textarea&gt;
&lt;input id="password" name="password" type="password" /&gt;
&lt;input id="parent_id" name="parent_id" type="hidden" value="5" /&gt;
&lt;input id="user_name" name="user[name]" type="search" /&gt;
&lt;input id="user_phone" name="user[phone]" type="tel" /&gt;
&lt;input id="user_born_on" name="user[born_on]" type="date" /&gt;
&lt;input id="user_meeting_time" name="user[meeting_time]" type="datetime" /&gt;
&lt;input id="user_graduation_day" name="user[graduation_day]" type="datetime-local" /&gt;
&lt;input id="user_birthday_month" name="user[birthday_month]" type="month" /&gt;
&lt;input id="user_birthday_week" name="user[birthday_week]" type="week" /&gt;
&lt;input id="user_homepage" name="user[homepage]" type="url" /&gt;
&lt;input id="user_address" name="user[address]" type="email" /&gt;
&lt;input id="user_favorite_color" name="user[favorite_color]" type="color" value="#000000" /&gt;
&lt;input id="task_started_at" name="task[started_at]" type="time" /&gt;
&lt;input id="product_price" max="20.0" min="1.0" name="product[price]" step="0.5" type="number" /&gt;
&lt;input id="product_discount" max="100" min="1" name="product[discount]" type="range" /&gt;

</pre>
</div>
<p>隱藏的 <code>input</code> 不會顯示給使用者，但和其它文字輸入一樣可以存放資料。隱藏的 <code>input</code> 的值可以使用 JavaScript 來修改。</p><div class="warning"><p>search、telephone、date、time、color、datetime、datetime-local、month、week、URL、email、number 以及 range inputs 是 HTML5 控件。若需要應用程式在舊版的瀏覽器也有一致的瀏覽體驗，需要使用 HTML5 polyfill（由 CSS 或 JavaScript 提供）。<a href="https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills">雖然 polyfill 很好</a>，但目前主流工具是 <a href="http://www.modernizr.com/">Modernizr</a> 以及 <a href="http://yepnopejs.com/">yepnope</a>，這兩個工具提供一種簡單的方式，用來新增 HTML5 的新功能。</p></div><div class="info"><p>若使用了 password input fields（不論用途），輸入的值可能不要記錄在 Log。詳細做法請參考安全指南：<a href="security.html#logging">logging 一節</a>。</p></div><h3 id="處理-model-物件">2 處理 Model 物件</h3><h4 id="model-物件輔助方法">2.1 Model 物件輔助方法</h4><p>A particularly common task for a form is editing or creating a model object. While the <code>*_tag</code> helpers can certainly be used for this task they are somewhat verbose as for each tag you would have to ensure the correct parameter name is used and set the default value of the input appropriately. Rails provides helpers tailored to this task. These helpers lack the <em>tag suffix, for example `text</em>field<code>,</code>text_area`.</p><p>For these helpers the first argument is the name of an instance variable and the second is the name of a method (usually an attribute) to call on that object. Rails will set the value of the input control to the return value of that method for the object and set an appropriate input name. If your controller has defined <code>@person</code> and that person's name is Henry then a form containing:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= text_field(:person, :name) %&gt;

</pre>
</div>
<p>will produce output similar to</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;input id="person_name" name="person[name]" type="text" value="Henry"/&gt;

</pre>
</div>
<p>Upon form submission the value entered by the user will be stored in <code>params[:person][:name]</code>. The <code>params[:person]</code> hash is suitable for passing to <code>Person.new</code> or, if <code>@person</code> is an instance of Person, <code>@person.update</code>. While the name of an attribute is the most common second parameter to these helpers this is not compulsory. In the example above, as long as person objects have a <code>name</code> and a <code>name=</code> method Rails will be happy.</p><div class="warning"><p>You must pass the name of an instance variable, i.e. <code>:person</code> or <code>"person"</code>, not an actual instance of your model object.</p></div><p>Rails provides helpers for displaying the validation errors associated with a model object. These are covered in detail by the <a href="./active_record_validations.html#displaying-validation-errors-in-views">Active Record Validations</a> guide.</p><h4 id="將表單綁定到物件">2.2 將表單綁定到物件</h4><p>While this is an increase in comfort it is far from perfect. If Person has many attributes to edit then we would be repeating the name of the edited object many times. What we want to do is somehow bind a form to a model object, which is exactly what <code>form_for</code> does.</p><p>Assume we have a controller for dealing with articles <code>app/controllers/articles_controller.rb</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def new
  @article = Article.new
end

</pre>
</div>
<p>The corresponding view <code>app/views/articles/new.html.erb</code> using <code>form_for</code> looks like this:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @article, url: {action: "create"}, html: {class: "nifty_form"} do |f| %&gt;
  &lt;%= f.text_field :title %&gt;
  &lt;%= f.text_area :body, size: "60x12" %&gt;
  &lt;%= f.submit "Create" %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>There are a few things to note here:</p>
<ul>
<li>
<code>@article</code> is the actual object being edited.</li>
<li>There is a single hash of options. Routing options are passed in the <code>:url</code> hash, HTML options are passed in the <code>:html</code> hash. Also you can provide a <code>:namespace</code> option for your form to ensure uniqueness of id attributes on form elements. The namespace attribute will be prefixed with underscore on the generated HTML id.</li>
<li>The <code>form_for</code> method yields a <strong>form builder</strong> object (the <code>f</code> variable).</li>
<li>Methods to create form controls are called <strong>on</strong> the form builder object <code>f</code>
</li>
</ul>
<p>The resulting HTML is:</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form accept-charset="UTF-8" action="/articles/create" method="post" class="nifty_form"&gt;
  &lt;input id="article_title" name="article[title]" type="text" /&gt;
  &lt;textarea id="article_body" name="article[body]" cols="60" rows="12"&gt;&lt;/textarea&gt;
  &lt;input name="commit" type="submit" value="Create" /&gt;
&lt;/form&gt;

</pre>
</div>
<p>The name passed to <code>form_for</code> controls the key used in <code>params</code> to access the form's values. Here the name is <code>article</code> and so all the inputs have names of the form <code>article[attribute_name]</code>. Accordingly, in the <code>create</code> action <code>params[:article]</code> will be a hash with keys <code>:title</code> and <code>:body</code>. You can read more about the significance of input names in the parameter_names section.</p><p>The helper methods called on the form builder are identical to the model object helpers except that it is not necessary to specify which object is being edited since this is already managed by the form builder.</p><p>You can create a similar binding without actually creating <code>&lt;form&gt;</code> tags with the <code>fields_for</code> helper. This is useful for editing additional model objects with the same form. For example if you had a Person model with an associated ContactDetail model you could create a form for creating both like so:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @person, url: {action: "create"} do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;%= fields_for @person.contact_detail do |contact_details_form| %&gt;
    &lt;%= contact_details_form.text_field :phone_number %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>which produces the following output:</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form accept-charset="UTF-8" action="/people/create" class="new_person" id="new_person" method="post"&gt;
  &lt;input id="person_name" name="person[name]" type="text" /&gt;
  &lt;input id="contact_detail_phone_number" name="contact_detail[phone_number]" type="text" /&gt;
&lt;/form&gt;

</pre>
</div>
<p>The object yielded by <code>fields_for</code> is a form builder like the one yielded by <code>form_for</code> (in fact <code>form_for</code> calls <code>fields_for</code> internally).</p><h4 id="relying-on-record-identification">2.3 Relying on Record Identification</h4><p>The Article model is directly available to users of the application, so - following the best practices for developing with Rails - you should declare it <strong>a resource</strong>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
resources :articles

</pre>
</div>
<div class="info"><p>Declaring a resource has a number of side-affects. See <a href="routing.html#resource-routing-the-rails-default">Rails Routing From the Outside In</a> for more information on setting up and using resources.</p></div><p>When dealing with RESTful resources, calls to <code>form_for</code> can get significantly easier if you rely on <strong>record identification</strong>. In short, you can just pass the model instance and have Rails figure out model name and the rest:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
## Creating a new article
# long-style:
form_for(@article, url: articles_path)
# same thing, short-style (record identification gets used):
form_for(@article)

## Editing an existing article
# long-style:
form_for(@article, url: article_path(@article), html: {method: "patch"})
# short-style:
form_for(@article)

</pre>
</div>
<p>Notice how the short-style <code>form_for</code> invocation is conveniently the same, regardless of the record being new or existing. Record identification is smart enough to figure out if the record is new by asking <code>record.new_record?</code>. It also selects the correct path to submit to and the name based on the class of the object.</p><p>Rails will also automatically set the <code>class</code> and <code>id</code> of the form appropriately: a form creating an article would have <code>id</code> and <code>class</code> <code>new_article</code>. If you were editing the article with id 23, the <code>class</code> would be set to <code>edit_article</code> and the id to <code>edit_article_23</code>. These attributes will be omitted for brevity in the rest of this guide.</p><div class="warning"><p>When you're using STI (single-table inheritance) with your models, you can't rely on record identification on a subclass if only their parent class is declared a resource. You will have to specify the model name, <code>:url</code>, and <code>:method</code> explicitly.</p></div><h5 id="dealing-with-namespaces">2.3.1 Dealing with Namespaces</h5><p>If you have created namespaced routes, <code>form_for</code> has a nifty shorthand for that too. If your application has an admin namespace then</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
form_for [:admin, @article]

</pre>
</div>
<p>will create a form that submits to the <code>ArticlesController</code> inside the admin namespace (submitting to <code>admin_article_path(@article)</code> in the case of an update). If you have several levels of namespacing then the syntax is similar:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
form_for [:admin, :management, @article]

</pre>
</div>
<p>For more information on Rails' routing system and the associated conventions, please see the <a href="routing.html">routing guide</a>.</p><h4 id="how-do-forms-with-patch,-put,-or-delete-methods-work-questionmark">2.4 How do forms with PATCH, PUT, or DELETE methods work?</h4><p>The Rails framework encourages RESTful design of your applications, which means you'll be making a lot of "PATCH" and "DELETE" requests (besides "GET" and "POST"). However, most browsers <em>don't support</em> methods other than "GET" and "POST" when it comes to submitting forms.</p><p>Rails works around this issue by emulating other methods over POST with a hidden input named <code>"_method"</code>, which is set to reflect the desired method:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
form_tag(search_path, method: "patch")

</pre>
</div>
<p>output:</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form accept-charset="UTF-8" action="/search" method="post"&gt;
  &lt;div style="margin:0;padding:0"&gt;
    &lt;input name="_method" type="hidden" value="patch" /&gt;
    &lt;input name="utf8" type="hidden" value="&amp;#x2713;" /&gt;
    &lt;input name="authenticity_token" type="hidden" value="f755bb0ed134b76c432144748a6d4b7a7ddf2b71" /&gt;
  &lt;/div&gt;
  ...

</pre>
</div>
<p>When parsing POSTed data, Rails will take into account the special <code>_method</code> parameter and acts as if the HTTP method was the one specified inside it ("PATCH" in this example).</p><h3 id="making-select-boxes-with-ease">3 Making Select Boxes with Ease</h3><p>Select boxes in HTML require a significant amount of markup (one <code>OPTION</code> element for each option to choose from), therefore it makes the most sense for them to be dynamically generated.</p><p>Here is what the markup might look like:</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;select name="city_id" id="city_id"&gt;
  &lt;option value="1"&gt;Lisbon&lt;/option&gt;
  &lt;option value="2"&gt;Madrid&lt;/option&gt;
  ...
  &lt;option value="12"&gt;Berlin&lt;/option&gt;
&lt;/select&gt;

</pre>
</div>
<p>Here you have a list of cities whose names are presented to the user. Internally the application only wants to handle their IDs so they are used as the options' value attribute. Let's see how Rails can help out here.</p><h4 id="the-select-and-option-tags">3.1 The Select and Option Tags</h4><p>The most generic helper is <code>select_tag</code>, which - as the name implies - simply generates the <code>SELECT</code> tag that encapsulates an options string:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= select_tag(:city_id, '&lt;option value="1"&gt;Lisbon&lt;/option&gt;...') %&gt;

</pre>
</div>
<p>This is a start, but it doesn't dynamically create the option tags. You can generate option tags with the <code>options_for_select</code> helper:</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= options_for_select([['Lisbon', 1], ['Madrid', 2], ...]) %&gt;

output:

&lt;option value="1"&gt;Lisbon&lt;/option&gt;
&lt;option value="2"&gt;Madrid&lt;/option&gt;
...

</pre>
</div>
<p>The first argument to <code>options_for_select</code> is a nested array where each element has two elements: option text (city name) and option value (city id). The option value is what will be submitted to your controller. Often this will be the id of a corresponding database object but this does not have to be the case.</p><p>Knowing this, you can combine <code>select_tag</code> and <code>options_for_select</code> to achieve the desired, complete markup:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= select_tag(:city_id, options_for_select(...)) %&gt;

</pre>
</div>
<p><code>options_for_select</code> allows you to pre-select an option by passing its value.</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= options_for_select([['Lisbon', 1], ['Madrid', 2], ...], 2) %&gt;

output:

&lt;option value="1"&gt;Lisbon&lt;/option&gt;
&lt;option value="2" selected="selected"&gt;Madrid&lt;/option&gt;
...

</pre>
</div>
<p>Whenever Rails sees that the internal value of an option being generated matches this value, it will add the <code>selected</code> attribute to that option.</p><div class="info"><p>The second argument to <code>options_for_select</code> must be exactly equal to the desired internal value. In particular if the value is the integer 2 you cannot pass "2" to <code>options_for_select</code> - you must pass 2. Be aware of values extracted from the <code>params</code> hash as they are all strings.</p></div><div class="warning"><p>when <code>:include_blank</code> or <code>:prompt</code> are not present, <code>:include_blank</code> is forced true if the select attribute <code>required</code> is true, display <code>size</code> is one and <code>multiple</code> is not true.</p></div><p>You can add arbitrary attributes to the options using hashes:</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= options_for_select([['Lisbon', 1, {'data-size' =&gt; '2.8 million'}], ['Madrid', 2, {'data-size' =&gt; '3.2 million'}]], 2) %&gt;

output:

&lt;option value="1" data-size="2.8 million"&gt;Lisbon&lt;/option&gt;
&lt;option value="2" selected="selected" data-size="3.2 million"&gt;Madrid&lt;/option&gt;
...

</pre>
</div>
<h4 id="select-boxes-for-dealing-with-models">3.2 Select Boxes for Dealing with Models</h4><p>In most cases form controls will be tied to a specific database model and as you might expect Rails provides helpers tailored for that purpose. Consistent with other form helpers, when dealing with models you drop the <code>_tag</code> suffix from <code>select_tag</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# controller:
@person = Person.new(city_id: 2)

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
# view:
&lt;%= select(:person, :city_id, [['Lisbon', 1], ['Madrid', 2], ...]) %&gt;

</pre>
</div>
<p>Notice that the third parameter, the options array, is the same kind of argument you pass to <code>options_for_select</code>. One advantage here is that you don't have to worry about pre-selecting the correct city if the user already has one - Rails will do this for you by reading from the <code>@person.city_id</code> attribute.</p><p>As with other helpers, if you were to use the <code>select</code> helper on a form builder scoped to the <code>@person</code> object, the syntax would be:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
# select on a form builder
&lt;%= f.select(:city_id, ...) %&gt;

</pre>
</div>
<div class="warning"><p>If you are using <code>select</code> (or similar helpers such as <code>collection_select</code>, <code>select_tag</code>) to set a <code>belongs_to</code> association you must pass the name of the foreign key (in the example above <code>city_id</code>), not the name of association itself. If you specify <code>city</code> instead of <code>city_id</code> Active Record will raise an error along the lines of <code>ActiveRecord::AssociationTypeMismatch: City(#17815740) expected, got String(#1138750)</code> when you pass the <code>params</code> hash to <code>Person.new</code> or <code>update</code>. Another way of looking at this is that form helpers only edit attributes. You should also be aware of the potential security ramifications of allowing users to edit foreign keys directly.</p></div><h4 id="option-tags-from-a-collection-of-arbitrary-objects">3.3 Option Tags from a Collection of Arbitrary Objects</h4><p>Generating options tags with <code>options_for_select</code> requires that you create an array containing the text and value for each option. But what if you had a City model (perhaps an Active Record one) and you wanted to generate option tags from a collection of those objects? One solution would be to make a nested array by iterating over them:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;% cities_array = City.all.map { |city| [city.name, city.id] } %&gt;
&lt;%= options_for_select(cities_array) %&gt;

</pre>
</div>
<p>This is a perfectly valid solution, but Rails provides a less verbose alternative: <code>options_from_collection_for_select</code>. This helper expects a collection of arbitrary objects and two additional arguments: the names of the methods to read the option <strong>value</strong> and <strong>text</strong> from, respectively:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= options_from_collection_for_select(City.all, :id, :name) %&gt;

</pre>
</div>
<p>As the name implies, this only generates option tags. To generate a working select box you would need to use it in conjunction with <code>select_tag</code>, just as you would with <code>options_for_select</code>. When working with model objects, just as <code>select</code> combines <code>select_tag</code> and <code>options_for_select</code>, <code>collection_select</code> combines <code>select_tag</code> with <code>options_from_collection_for_select</code>.</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= collection_select(:person, :city_id, City.all, :id, :name) %&gt;

</pre>
</div>
<p>To recap, <code>options_from_collection_for_select</code> is to <code>collection_select</code> what <code>options_for_select</code> is to <code>select</code>.</p><div class="note"><p>Pairs passed to <code>options_for_select</code> should have the name first and the id second, however with <code>options_from_collection_for_select</code> the first argument is the value method and the second the text method.</p></div><h4 id="time-zone-and-country-select">3.4 Time Zone and Country Select</h4><p>To leverage time zone support in Rails, you have to ask your users what time zone they are in. Doing so would require generating select options from a list of pre-defined TimeZone objects using <code>collection_select</code>, but you can simply use the <code>time_zone_select</code> helper that already wraps this:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= time_zone_select(:person, :time_zone) %&gt;

</pre>
</div>
<p>There is also <code>time_zone_options_for_select</code> helper for a more manual (therefore more customizable) way of doing this. Read the API documentation to learn about the possible arguments for these two methods.</p><p>Rails <em>used</em> to have a <code>country_select</code> helper for choosing countries, but this has been extracted to the <a href="https://github.com/stefanpenner/country_select">country_select plugin</a>. When using this, be aware that the exclusion or inclusion of certain names from the list can be somewhat controversial (and was the reason this functionality was extracted from Rails).</p><h3 id="using-date-and-time-form-helpers">4 Using Date and Time Form Helpers</h3><p>You can choose not to use the form helpers generating HTML5 date and time input fields and use the alternative date and time helpers. These date and time helpers differ from all the other form helpers in two important respects:</p>
<ul>
<li>Dates and times are not representable by a single input element. Instead you have several, one for each component (year, month, day etc.) and so there is no single value in your <code>params</code> hash with your date or time.</li>
<li>Other helpers use the <code>_tag</code> suffix to indicate whether a helper is a barebones helper or one that operates on model objects. With dates and times, <code>select_date</code>, <code>select_time</code> and <code>select_datetime</code> are the barebones helpers, <code>date_select</code>, <code>time_select</code> and <code>datetime_select</code> are the equivalent model object helpers.</li>
</ul>
<p>Both of these families of helpers will create a series of select boxes for the different components (year, month, day etc.).</p><h4 id="barebones-helpers">4.1 Barebones Helpers</h4><p>The <code>select_*</code> family of helpers take as their first argument an instance of Date, Time or DateTime that is used as the currently selected value. You may omit this parameter, in which case the current date is used. For example</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= select_date Date.today, prefix: :start_date %&gt;

</pre>
</div>
<p>outputs (with actual option values omitted for brevity)</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;select id="start_date_year" name="start_date[year]"&gt; ... &lt;/select&gt;
&lt;select id="start_date_month" name="start_date[month]"&gt; ... &lt;/select&gt;
&lt;select id="start_date_day" name="start_date[day]"&gt; ... &lt;/select&gt;

</pre>
</div>
<p>The above inputs would result in <code>params[:start_date]</code> being a hash with keys <code>:year</code>, <code>:month</code>, <code>:day</code>. To get an actual Time or Date object you would have to extract these values and pass them to the appropriate constructor, for example</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Date.civil(params[:start_date][:year].to_i, params[:start_date][:month].to_i, params[:start_date][:day].to_i)

</pre>
</div>
<p>The <code>:prefix</code> option is the key used to retrieve the hash of date components from the <code>params</code> hash. Here it was set to <code>start_date</code>, if omitted it will default to <code>date</code>.</p><h4 id="model-object-helpers">4.2 Model Object Helpers</h4><p><code>select_date</code> does not work well with forms that update or create Active Record objects as Active Record expects each element of the <code>params</code> hash to correspond to one attribute.
The model object helpers for dates and times submit parameters with special names; when Active Record sees parameters with such names it knows they must be combined with the other parameters and given to a constructor appropriate to the column type. For example:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= date_select :person, :birth_date %&gt;

</pre>
</div>
<p>outputs (with actual option values omitted for brevity)</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;select id="person_birth_date_1i" name="person[birth_date(1i)]"&gt; ... &lt;/select&gt;
&lt;select id="person_birth_date_2i" name="person[birth_date(2i)]"&gt; ... &lt;/select&gt;
&lt;select id="person_birth_date_3i" name="person[birth_date(3i)]"&gt; ... &lt;/select&gt;

</pre>
</div>
<p>which results in a <code>params</code> hash like</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{'person' =&gt; {'birth_date(1i)' =&gt; '2008', 'birth_date(2i)' =&gt; '11', 'birth_date(3i)' =&gt; '22'}}

</pre>
</div>
<p>When this is passed to <code>Person.new</code> (or <code>update</code>), Active Record spots that these parameters should all be used to construct the <code>birth_date</code> attribute and uses the suffixed information to determine in which order it should pass these parameters to functions such as <code>Date.civil</code>.</p><h4 id="common-options">4.3 Common Options</h4><p>Both families of helpers use the same core set of functions to generate the individual select tags and so both accept largely the same options. In particular, by default Rails will generate year options 5 years either side of the current year. If this is not an appropriate range, the <code>:start_year</code> and <code>:end_year</code> options override this. For an exhaustive list of the available options, refer to the <a href="http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html">API documentation</a>.</p><p>As a rule of thumb you should be using <code>date_select</code> when working with model objects and <code>select_date</code> in other cases, such as a search form which filters results by date.</p><div class="note"><p>In many cases the built-in date pickers are clumsy as they do not aid the user in working out the relationship between the date and the day of the week.</p></div><h4 id="individual-components">4.4 Individual Components</h4><p>Occasionally you need to display just a single date component such as a year or a month. Rails provides a series of helpers for this, one for each component <code>select_year</code>, <code>select_month</code>, <code>select_day</code>, <code>select_hour</code>, <code>select_minute</code>, <code>select_second</code>. These helpers are fairly straightforward. By default they will generate an input field named after the time component (for example "year" for <code>select_year</code>, "month" for <code>select_month</code> etc.) although this can be overridden with the <code>:field_name</code> option. The <code>:prefix</code> option works in the same way that it does for <code>select_date</code> and <code>select_time</code> and has the same default value.</p><p>The first parameter specifies which value should be selected and can either be an instance of a Date, Time or DateTime, in which case the relevant component will be extracted, or a numerical value. For example</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= select_year(2009) %&gt;
&lt;%= select_year(Time.now) %&gt;

</pre>
</div>
<p>will produce the same output if the current year is 2009 and the value chosen by the user can be retrieved by <code>params[:date][:year]</code>.</p><h3 id="uploading-files">5 Uploading Files</h3><p>A common task is uploading some sort of file, whether it's a picture of a person or a CSV file containing data to process. The most important thing to remember with file uploads is that the rendered form's encoding <strong>MUST</strong> be set to "multipart/form-data". If you use <code>form_for</code>, this is done automatically. If you use <code>form_tag</code>, you must set it yourself, as per the following example.</p><p>The following two forms both upload a file.</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_tag({action: :upload}, multipart: true) do %&gt;
  &lt;%= file_field_tag 'picture' %&gt;
&lt;% end %&gt;

&lt;%= form_for @person do |f| %&gt;
  &lt;%= f.file_field :picture %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>Rails provides the usual pair of helpers: the barebones <code>file_field_tag</code> and the model oriented <code>file_field</code>. The only difference with other helpers is that you cannot set a default value for file inputs as this would have no meaning. As you would expect in the first case the uploaded file is in <code>params[:picture]</code> and in the second case in <code>params[:person][:picture]</code>.</p><h4 id="what-gets-uploaded">5.1 What Gets Uploaded</h4><p>The object in the <code>params</code> hash is an instance of a subclass of IO. Depending on the size of the uploaded file it may in fact be a StringIO or an instance of File backed by a temporary file. In both cases the object will have an <code>original_filename</code> attribute containing the name the file had on the user's computer and a <code>content_type</code> attribute containing the MIME type of the uploaded file. The following snippet saves the uploaded content in <code>#{Rails.root}/public/uploads</code> under the same name as the original file (assuming the form was the one in the previous example).</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def upload
  uploaded_io = params[:person][:picture]
  File.open(Rails.root.join('public', 'uploads', uploaded_io.original_filename), 'wb') do |file|
    file.write(uploaded_io.read)
  end
end

</pre>
</div>
<p>Once a file has been uploaded, there are a multitude of potential tasks, ranging from where to store the files (on disk, Amazon S3, etc) and associating them with models to resizing image files and generating thumbnails. The intricacies of this are beyond the scope of this guide, but there are several libraries designed to assist with these. Two of the better known ones are <a href="https://github.com/jnicklas/carrierwave">CarrierWave</a> and <a href="http://www.thoughtbot.com/projects/paperclip">Paperclip</a>.</p><div class="note"><p>If the user has not selected a file the corresponding parameter will be an empty string.</p></div><h4 id="dealing-with-ajax">5.2 Dealing with Ajax</h4><p>Unlike other forms making an asynchronous file upload form is not as simple as providing <code>form_for</code> with <code>remote: true</code>. With an Ajax form the serialization is done by JavaScript running inside the browser and since JavaScript cannot read files from your hard drive the file cannot be uploaded. The most common workaround is to use an invisible iframe that serves as the target for the form submission.</p><h3 id="customizing-form-builders">6 Customizing Form Builders</h3><p>As mentioned previously the object yielded by <code>form_for</code> and <code>fields_for</code> is an instance of FormBuilder (or a subclass thereof). Form builders encapsulate the notion of displaying form elements for a single object. While you can of course write helpers for your forms in the usual way, you can also subclass FormBuilder and add the helpers there. For example</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @person do |f| %&gt;
  &lt;%= text_field_with_label f, :first_name %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>can be replaced with</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @person, builder: LabellingFormBuilder do |f| %&gt;
  &lt;%= f.text_field :first_name %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>by defining a LabellingFormBuilder class similar to the following:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class LabellingFormBuilder &lt; ActionView::Helpers::FormBuilder
  def text_field(attribute, options={})
    label(attribute) + super
  end
end

</pre>
</div>
<p>If you reuse this frequently you could define a <code>labeled_form_for</code> helper that automatically applies the <code>builder: LabellingFormBuilder</code> option.</p><p>The form builder used also determines what happens when you do</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= render partial: f %&gt;

</pre>
</div>
<p>If <code>f</code> is an instance of FormBuilder then this will render the <code>form</code> partial, setting the partial's object to the form builder. If the form builder is of class LabellingFormBuilder then the <code>labelling_form</code> partial would be rendered instead.</p><h3 id="understanding-parameter-naming-conventions">7 Understanding Parameter Naming Conventions</h3><p>As you've seen in the previous sections, values from forms can be at the top level of the <code>params</code> hash or nested in another hash. For example in a standard <code>create</code>
action for a Person model, <code>params[:person]</code> would usually be a hash of all the attributes for the person to create. The <code>params</code> hash can also contain arrays, arrays of hashes and so on.</p><p>Fundamentally HTML forms don't know about any sort of structured data, all they generate is name-value pairs, where pairs are just plain strings. The arrays and hashes you see in your application are the result of some parameter naming conventions that Rails uses.</p><div class="info"><p>You may find you can try out examples in this section faster by using the console to directly invoke Racks' parameter parser. For example,</p></div><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Rack::Utils.parse_query "name=fred&amp;phone=0123456789"
# =&gt; {"name"=&gt;"fred", "phone"=&gt;"0123456789"}

</pre>
</div>
<h4 id="basic-structures">7.1 Basic Structures</h4><p>The two basic structures are arrays and hashes. Hashes mirror the syntax used for accessing the value in <code>params</code>. For example if a form contains</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="person_name" name="person[name]" type="text" value="Henry"/&gt;

</pre>
</div>
<p>the <code>params</code> hash will contain</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
{'person' =&gt; {'name' =&gt; 'Henry'}}

</pre>
</div>
<p>and <code>params[:person][:name]</code> will retrieve the submitted value in the controller.</p><p>Hashes can be nested as many levels as required, for example</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="person_address_city" name="person[address][city]" type="text" value="New York"/&gt;

</pre>
</div>
<p>will result in the <code>params</code> hash being</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{'person' =&gt; {'address' =&gt; {'city' =&gt; 'New York'}}}

</pre>
</div>
<p>Normally Rails ignores duplicate parameter names. If the parameter name contains an empty set of square brackets [] then they will be accumulated in an array. If you wanted people to be able to input multiple phone numbers, you could place this in the form:</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;
&lt;input name="person[phone_number][]" type="text"/&gt;

</pre>
</div>
<p>This would result in <code>params[:person][:phone_number]</code> being an array.</p><h4 id="combining-them">7.2 Combining Them</h4><p>We can mix and match these two concepts. For example, one element of a hash might be an array as in the previous example, or you can have an array of hashes. For example a form might let you create any number of addresses by repeating the following form fragment</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input name="addresses[][line1]" type="text"/&gt;
&lt;input name="addresses[][line2]" type="text"/&gt;
&lt;input name="addresses[][city]" type="text"/&gt;

</pre>
</div>
<p>This would result in <code>params[:addresses]</code> being an array of hashes with keys <code>line1</code>, <code>line2</code> and <code>city</code>. Rails decides to start accumulating values in a new hash whenever it encounters an input name that already exists in the current hash.</p><p>There's a restriction, however, while hashes can be nested arbitrarily, only one level of "arrayness" is allowed. Arrays can be usually replaced by hashes, for example instead of having an array of model objects one can have a hash of model objects keyed by their id, an array index or some other parameter.</p><div class="warning"><p>Array parameters do not play well with the <code>check_box</code> helper. According to the HTML specification unchecked checkboxes submit no value. However it is often convenient for a checkbox to always submit a value. The <code>check_box</code> helper fakes this by creating an auxiliary hidden input with the same name. If the checkbox is unchecked only the hidden input is submitted and if it is checked then both are submitted but the value submitted by the checkbox takes precedence. When working with array parameters this duplicate submission will confuse Rails since duplicate input names are how it decides when to start a new array element. It is preferable to either use <code>check_box_tag</code> or to use hashes instead of arrays.</p></div><h4 id="using-form-helpers">7.3 Using Form Helpers</h4><p>The previous sections did not use the Rails form helpers at all. While you can craft the input names yourself and pass them directly to helpers such as <code>text_field_tag</code> Rails also provides higher level support. The two tools at your disposal here are the name parameter to <code>form_for</code> and <code>fields_for</code> and the <code>:index</code> option that helpers take.</p><p>You might want to render a form with a set of edit fields for each of a person's addresses. For example:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @person do |person_form| %&gt;
  &lt;%= person_form.text_field :name %&gt;
  &lt;% @person.addresses.each do |address| %&gt;
    &lt;%= person_form.fields_for address, index: address.id do |address_form|%&gt;
      &lt;%= address_form.text_field :city %&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>Assuming the person had two addresses, with ids 23 and 45 this would create output similar to this:</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;form accept-charset="UTF-8" action="/people/1" class="edit_person" id="edit_person_1" method="post"&gt;
  &lt;input id="person_name" name="person[name]" type="text" /&gt;
  &lt;input id="person_address_23_city" name="person[address][23][city]" type="text" /&gt;
  &lt;input id="person_address_45_city" name="person[address][45][city]" type="text" /&gt;
&lt;/form&gt;

</pre>
</div>
<p>This will result in a <code>params</code> hash that looks like</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{'person' =&gt; {'name' =&gt; 'Bob', 'address' =&gt; {'23' =&gt; {'city' =&gt; 'Paris'}, '45' =&gt; {'city' =&gt; 'London'}}}}

</pre>
</div>
<p>Rails knows that all these inputs should be part of the person hash because you
called <code>fields_for</code> on the first form builder. By specifying an <code>:index</code> option
you're telling Rails that instead of naming the inputs <code>person[address][city]</code>
it should insert that index surrounded by [] between the address and the city.
This is often useful as it is then easy to locate which Address record
should be modified. You can pass numbers with some other significance,
strings or even <code>nil</code> (which will result in an array parameter being created).</p><p>To create more intricate nestings, you can specify the first part of the input
name (<code>person[address]</code> in the previous example) explicitly:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= fields_for 'person[address][primary]', address, index: address do |address_form| %&gt;
  &lt;%= address_form.text_field :city %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>will create inputs like</p><div class="code_container">
<pre class="brush: xml; gutter: false; toolbar: false">
&lt;input id="person_address_primary_1_city" name="person[address][primary][1][city]" type="text" value="bologna" /&gt;

</pre>
</div>
<p>As a general rule the final input name is the concatenation of the name given to <code>fields_for</code>/<code>form_for</code>, the index value and the name of the attribute. You can also pass an <code>:index</code> option directly to helpers such as <code>text_field</code>, but it is usually less repetitive to specify this at the form builder level rather than on individual input controls.</p><p>As a shortcut you can append [] to the name and omit the <code>:index</code> option. This is the same as specifying <code>index: address</code> so</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= fields_for 'person[address][primary][]', address do |address_form| %&gt;
  &lt;%= address_form.text_field :city %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>produces exactly the same output as the previous example.</p><h3 id="forms-to-external-resources">8 Forms to external resources</h3><p>If you need to post some data to an external resource it is still great to build your form using rails form helpers. But sometimes you need to set an <code>authenticity_token</code> for this resource. You can do it by passing an <code>authenticity_token: 'your_external_token'</code> parameter to the <code>form_tag</code> options:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_tag 'http://farfar.away/form', authenticity_token: 'external_token') do %&gt;
  Form contents
&lt;% end %&gt;

</pre>
</div>
<p>Sometimes when you submit data to an external resource, like payment gateway, fields you can use in your form are limited by an external API. So you may want not to generate an <code>authenticity_token</code> hidden field at all. For doing this just pass <code>false</code> to the <code>:authenticity_token</code> option:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_tag 'http://farfar.away/form', authenticity_token: false) do %&gt;
  Form contents
&lt;% end %&gt;

</pre>
</div>
<p>The same technique is also available for <code>form_for</code>:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @invoice, url: external_url, authenticity_token: 'external_token' do |f| %&gt;
  Form contents
&lt;% end %&gt;

</pre>
</div>
<p>Or if you don't want to render an <code>authenticity_token</code> field:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @invoice, url: external_url, authenticity_token: false do |f| %&gt;
  Form contents
&lt;% end %&gt;

</pre>
</div>
<h3 id="building-complex-forms">9 Building Complex Forms</h3><p>Many apps grow beyond simple forms editing a single object. For example when creating a Person you might want to allow the user to (on the same form) create multiple address records (home, work, etc.). When later editing that person the user should be able to add, remove or amend addresses as necessary.</p><h4 id="configuring-the-model">9.1 Configuring the Model</h4><p>Active Record provides model level support via the <code>accepts_nested_attributes_for</code> method:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Person &lt; ActiveRecord::Base
  has_many :addresses
  accepts_nested_attributes_for :addresses
end

class Address &lt; ActiveRecord::Base
  belongs_to :person
end

</pre>
</div>
<p>This creates an <code>addresses_attributes=</code> method on <code>Person</code> that allows you to create, update and (optionally) destroy addresses.</p><h4 id="nested-forms">9.2 Nested Forms</h4><p>The following form allows a user to create a <code>Person</code> and its associated addresses.</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;%= form_for @person do |f| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= f.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;

        &lt;%= addresses_form.label :street %&gt;
        &lt;%= addresses_form.text_field :street %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;

</pre>
</div>
<p>When an association accepts nested attributes <code>fields_for</code> renders its block once for every element of the association. In particular, if a person has no addresses it renders nothing. A common pattern is for the controller to build one or more empty children so that at least one set of fields is shown to the user. The example below would result in 2 sets of address fields being rendered on the new person form.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def new
  @person = Person.new
  2.times { @person.addresses.build}
end

</pre>
</div>
<p>The <code>fields_for</code> yields a form builder. The parameters' name will be what
<code>accepts_nested_attributes_for</code> expects. For example when creating a user with
2 addresses, the submitted parameters would look like:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
{
  'person' =&gt; {
    'name' =&gt; 'John Doe',
    'addresses_attributes' =&gt; {
      '0' =&gt; {
        'kind' =&gt; 'Home',
        'street' =&gt; '221b Baker Street'
      },
      '1' =&gt; {
        'kind' =&gt; 'Office',
        'street' =&gt; '31 Spooner Street'
      }
    }
  }
}

</pre>
</div>
<p>The keys of the <code>:addresses_attributes</code> hash are unimportant, they need merely be different for each address.</p><p>If the associated object is already saved, <code>fields_for</code> autogenerates a hidden input with the <code>id</code> of the saved record. You can disable this by passing <code>include_id: false</code> to <code>fields_for</code>. You may wish to do this if the autogenerated input is placed in a location where an input tag is not valid HTML or when using an ORM where children do not have an <code>id</code>.</p><h4 id="the-controller">9.3 The Controller</h4><p>As usual you need to
<a href="action_controller_overview.html#strong-parameters">whitelist the parameters</a> in
the controller before you pass them to the model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def create
  @person = Person.new(person_params)
  # ...
end

private
  def person_params
    params.require(:person).permit(:name, addresses_attributes: [:id, :kind, :street])
  end

</pre>
</div>
<h4 id="removing-objects">9.4 Removing Objects</h4><p>You can allow users to delete associated objects by passing <code>allow_destroy: true</code> to <code>accepts_nested_attributes_for</code></p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Person &lt; ActiveRecord::Base
  has_many :addresses
  accepts_nested_attributes_for :addresses, allow_destroy: true
end

</pre>
</div>
<p>If the hash of attributes for an object contains the key <code>_destroy</code> with a value
of <code>1</code> or <code>true</code> then the object will be destroyed. This form allows users to
remove addresses:</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;%= form_for @person do |f| %&gt;
  Addresses:
  &lt;ul&gt;
    &lt;%= f.fields_for :addresses do |addresses_form| %&gt;
      &lt;li&gt;
        &lt;%= addresses_form.check_box :_destroy%&gt;
        &lt;%= addresses_form.label :kind %&gt;
        &lt;%= addresses_form.text_field :kind %&gt;
        ...
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;/ul&gt;
&lt;% end %&gt;

</pre>
</div>
<p>Don't forget to update the whitelisted params in your controller to also include
the <code>_destroy</code> field:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
def person_params
  params.require(:person).
    permit(:name, addresses_attributes: [:id, :kind, :street, :_destroy])
end

</pre>
</div>
<h4 id="preventing-empty-records">9.5 Preventing Empty Records</h4><p>It is often useful to ignore sets of fields that the user has not filled in. You can control this by passing a <code>:reject_if</code> proc to <code>accepts_nested_attributes_for</code>. This proc will be called with each hash of attributes submitted by the form. If the proc returns <code>false</code> then Active Record will not build an associated object for that hash. The example below only tries to build an address if the <code>kind</code> attribute is set.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Person &lt; ActiveRecord::Base
  has_many :addresses
  accepts_nested_attributes_for :addresses, reject_if: lambda {|attributes| attributes['kind'].blank?}
end

</pre>
</div>
<p>As a convenience you can instead pass the symbol <code>:all_blank</code> which will create a proc that will reject records where all the attributes are blank excluding any value for <code>_destroy</code>.</p><h4 id="adding-fields-on-the-fly">9.6 Adding Fields on the Fly</h4><p>Rather than rendering multiple sets of fields ahead of time you may wish to add them only when a user clicks on an 'Add new address' button. Rails does not provide any builtin support for this. When generating new sets of fields you must ensure the key of the associated array is unique - the current JavaScript date (milliseconds after the epoch) is a common choice.</p>

        <h3>反饋</h3>
        <p>
          歡迎幫忙改善指南的品質。
        </p>
        <p>
          如發現任何錯誤之處，歡迎修正。開始貢獻前，可以先閱讀<a href="http://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">貢獻指南：文件</a>。
        </p>
        <p>翻譯如有錯誤，深感抱歉，歡迎 <a href="https://github.com/docrails-tw/guides/fork">Fork</a> 修正，或至此處<a href="https://github.com/docsrails-tw/guides/issues/new">回報</a>。</p>
        <p>
          文章可能有未完成或過時的內容。請先檢查 <a href="http://edgeguides.rubyonrails.org">Edge Guides</a> 來確定問題在 master 是否已經修掉了。再上 master 補上缺少的文件。內容參考 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails 指南準則</a>來了解行文風格。
        </p>
        <p>最後，任何關於 Ruby on Rails 文件的討論，歡迎至 <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs 郵件論壇</a>。
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>本著作係採用<a href="https://creativecommons.org/licenses/by-sa/4.0/">創用 CC 姓名標示-相同方式分享 4.0 國際授權條款</a>授權。</p>
<p>“Rails”、“Ruby on Rails”，以及 Rails logo 為 David Heinemeier Hansson 的商標。版權所有。</p>

    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all();
    $(guidesIndex.bind);
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49903900-1', 'docrails-tw.github.io');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');

  </script>
</body>
</html>
